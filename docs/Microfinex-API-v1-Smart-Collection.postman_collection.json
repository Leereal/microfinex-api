{
  "info": {
    "name": "Microfinex API v1 - Smart Collection",
    "description": "Modern Microfinance Management System API with automatic variable population and JWT token handling. This collection automatically extracts and stores IDs, tokens, and other data from responses for seamless API testing.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "_postman_id": "microfinex-api-v1",
    "version": {
      "major": 1,
      "minor": 0,
      "patch": 0
    }
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8000/api/v1",
      "description": "Base URL for the API"
    },
    {
      "key": "authToken",
      "value": "",
      "description": "JWT access token (auto-populated from login)"
    },
    {
      "key": "refreshToken",
      "value": "",
      "description": "JWT refresh token (auto-populated from login)"
    },
    {
      "key": "userId",
      "value": "",
      "description": "Current user ID (auto-populated from login)"
    },
    {
      "key": "organizationId",
      "value": "",
      "description": "Current organization ID (auto-populated from login)"
    },
    {
      "key": "clientId",
      "value": "",
      "description": "Last created/retrieved client ID"
    },
    {
      "key": "loanId",
      "value": "",
      "description": "Last created/retrieved loan ID"
    },
    {
      "key": "paymentId",
      "value": "",
      "description": "Last created/retrieved payment ID"
    },
    {
      "key": "groupId",
      "value": "",
      "description": "Last created/retrieved group ID"
    },
    {
      "key": "employerId",
      "value": "",
      "description": "Last created/retrieved employer ID"
    },
    {
      "key": "shopId",
      "value": "",
      "description": "Last created/retrieved shop ID"
    },
    {
      "key": "shopProductId",
      "value": "",
      "description": "Last created/retrieved shop product ID"
    },
    {
      "key": "loanItemId",
      "value": "",
      "description": "Last created/retrieved loan item ID"
    },
    {
      "key": "applicationId",
      "value": "",
      "description": "Last created/retrieved online application ID"
    },
    {
      "key": "visitId",
      "value": "",
      "description": "Last created/retrieved visit ID"
    },
    {
      "key": "pledgeId",
      "value": "",
      "description": "Last created/retrieved pledge ID"
    },
    {
      "key": "branchId",
      "value": "",
      "description": "Current branch ID"
    },
    {
      "key": "productId",
      "value": "",
      "description": "Loan product ID"
    },
    {
      "key": "categoryId",
      "value": "",
      "description": "Loan category ID"
    },
    {
      "key": "targetUserId",
      "value": "",
      "description": "Target user ID for user management operations"
    },
    {
      "key": "roleId",
      "value": "",
      "description": "Last created/retrieved role ID for RBAC operations"
    },
    {
      "key": "auditLogId",
      "value": "",
      "description": "Last retrieved audit log ID"
    },
    {
      "key": "assessmentId",
      "value": "",
      "description": "Last created/retrieved loan assessment ID"
    },
    {
      "key": "verificationCode",
      "value": "",
      "description": "OTP verification code for online applications (dev mode only)"
    }
  ],
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{authToken}}",
        "type": "string"
      }
    ]
  },
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global pre-request script with enhanced token management",
          "console.log('üöÄ Making request to: ' + pm.request.url);",
          "",
          "// Auto-check and warn about missing auth token",
          "const authToken = pm.collectionVariables.get('authToken');",
          "const requestUrl = pm.request.url.toString();",
          "const isAuthEndpoint = requestUrl.includes('/auth/') || requestUrl.includes('/health');",
          "",
          "if (!authToken && !isAuthEndpoint) {",
          "    console.log('‚ö†Ô∏è No auth token found. Please login first using the Login request.');",
          "    console.log('üí° Tip: The Login request will automatically populate the authToken variable.');",
          "}",
          "",
          "// Add request timestamp",
          "const timestamp = new Date().toISOString();",
          "console.log('‚è∞ Request timestamp: ' + timestamp);",
          "",
          "// Auto-refresh token if it's about to expire (optional feature)",
          "if (authToken) {",
          "    try {",
          "        const tokenPayload = JSON.parse(atob(authToken.split('.')[1]));",
          "        const expirationTime = tokenPayload.exp * 1000;",
          "        const currentTime = Date.now();",
          "        const timeUntilExpiry = expirationTime - currentTime;",
          "        ",
          "        if (timeUntilExpiry < 300000) { // Less than 5 minutes",
          "            console.log('‚ö†Ô∏è Token expires in less than 5 minutes. Consider refreshing.');",
          "        }",
          "    } catch (e) {",
          "        // Ignore token parsing errors",
          "    }",
          "}"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Global test script with enhanced logging",
          "const responseTime = pm.response.responseTime;",
          "console.log('‚è±Ô∏è Response time: ' + responseTime + 'ms');",
          "",
          "// Enhanced error handling and logging",
          "if (pm.response.code >= 400) {",
          "    console.log('‚ùå Error response (' + pm.response.code + '):');",
          "    try {",
          "        const errorBody = pm.response.json();",
          "        console.log('   Message: ' + (errorBody.message || 'Unknown error'));",
          "        console.log('   Error: ' + (errorBody.error || 'No error code'));",
          "        ",
          "        // Special handling for auth errors",
          "        if (pm.response.code === 401) {",
          "            console.log('üîê Authentication required. Please login first.');",
          "        }",
          "    } catch (e) {",
          "        console.log('   Raw response: ' + pm.response.text());",
          "    }",
          "} else {",
          "    console.log('‚úÖ Request successful (' + pm.response.code + ')');",
          "    ",
          "    // Log response data for successful requests",
          "    try {",
          "        const responseBody = pm.response.json();",
          "        if (responseBody.message) {",
          "            console.log('üìù Response: ' + responseBody.message);",
          "        }",
          "    } catch (e) {",
          "        // Ignore JSON parsing errors",
          "    }",
          "}"
        ]
      }
    }
  ],
  "item": [
    {
      "name": "üîê Authentication",
      "description": "Authentication endpoints with automatic token management",
      "item": [
        {
          "name": "Login",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// Enhanced login response handler with automatic token population",
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    try {",
                  "        const response = pm.response.json();",
                  "        ",
                  "        if (response.success && response.data) {",
                  "            // üîë AUTOMATIC TOKEN POPULATION",
                  "            if (response.data.token) {",
                  "                pm.collectionVariables.set('authToken', response.data.token);",
                  "                console.log('üîê ‚úÖ Auth token automatically updated!');",
                  "                console.log('üîê üìã Token length: ' + response.data.token.length + ' characters');",
                  "                ",
                  "                // Decode and show token info",
                  "                try {",
                  "                    const tokenPayload = JSON.parse(atob(response.data.token.split('.')[1]));",
                  "                    const expirationDate = new Date(tokenPayload.exp * 1000);",
                  "                    console.log('üîê ‚è∞ Token expires: ' + expirationDate.toLocaleString());",
                  "                    console.log('üîê üë§ Token user: ' + tokenPayload.email);",
                  "                } catch (e) {",
                  "                    console.log('üîê ‚ö†Ô∏è Could not decode token payload');",
                  "                }",
                  "            }",
                  "            ",
                  "            // Handle legacy token format (tokens.access)",
                  "            if (response.data.tokens && response.data.tokens.access) {",
                  "                pm.collectionVariables.set('authToken', response.data.tokens.access);",
                  "                pm.collectionVariables.set('refreshToken', response.data.tokens.refresh);",
                  "                console.log('üîê ‚úÖ Auth tokens updated (legacy format)');",
                  "            }",
                  "            ",
                  "            // Set user information",
                  "            if (response.data.user) {",
                  "                pm.collectionVariables.set('userId', response.data.user.id);",
                  "                if (response.data.user.organization && response.data.user.organization.id) {",
                  "                    pm.collectionVariables.set('organizationId', response.data.user.organization.id);",
                  "                    console.log('üè¢ Organization ID set: ' + response.data.user.organization.id);",
                  "                } else {",
                  "                    // Super admin case (organizationId is null)",
                  "                    pm.collectionVariables.set('organizationId', '');",
                  "                    console.log('üëë Super Admin detected - no organization restriction');",
                  "                }",
                  "                console.log('üë§ User info updated: ' + response.data.user.firstName + ' ' + response.data.user.lastName);",
                  "                console.log('üé≠ User role: ' + response.data.user.role);",
                  "            }",
                  "            ",
                  "            // Success notification",
                  "            console.log('');",
                  "            console.log('üéâ LOGIN SUCCESSFUL!');",
                  "            console.log('‚ú® All subsequent requests will now use the auth token automatically.');",
                  "            console.log('üöÄ You can now use any protected endpoint without manually setting tokens.');",
                  "            console.log('');",
                  "            ",
                  "        } else {",
                  "            console.log('‚ö†Ô∏è Login response missing expected data structure');",
                  "        }",
                  "    } catch (error) {",
                  "        console.log('‚ùå Error processing login response: ' + error.message);",
                  "    }",
                  "}",
                  "",
                  "pm.test('Response has success true', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "pm.test('Response contains user data', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('user');",
                  "    pm.expect(jsonData.data).to.have.property('token');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"leereal08@ymail.com\",\n  \"password\": \"Mutabvuri$8\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/login",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "login"]
            },
            "description": "üîê **AUTOMATIC TOKEN MANAGEMENT**\\n\\nThis request automatically handles all authentication for you:\\n\\n**What it does:**\\n‚úÖ Logs you into the system\\n‚úÖ Automatically populates the `authToken` variable\\n‚úÖ Sets user ID and organization ID\\n‚úÖ Enables all subsequent requests to work without manual token setup\\n\\n**How to use:**\\n1. Click Send\\n2. That's it! All other requests will now work automatically\\n\\n**Token Features:**\\n- Auto-population of JWT token\\n- Token expiration tracking\\n- User role and organization detection\\n- Super Admin detection\\n\\n**Default Credentials:**\\n- Email: leereal08@ymail.com\\n- Password: Mutabvuri$8\\n- Role: SUPER_ADMIN"
          }
        },
        {
          "name": "Register User",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// Auto-populate user info from registration response",
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    ",
                  "    if (response.success && response.data) {",
                  "        // Set user information",
                  "        if (response.data.user) {",
                  "            pm.collectionVariables.set('userId', response.data.user.id);",
                  "            pm.collectionVariables.set('organizationId', response.data.user.organizationId);",
                  "            console.log('‚úÖ New user info updated');",
                  "        }",
                  "        ",
                  "        // Set tokens if provided",
                  "        if (response.data.tokens) {",
                  "            pm.collectionVariables.set('authToken', response.data.tokens.access);",
                  "            pm.collectionVariables.set('refreshToken', response.data.tokens.refresh);",
                  "            console.log('‚úÖ Auth tokens updated from registration');",
                  "        }",
                  "    }",
                  "}",
                  "",
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('User created successfully', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"newuser@microfinex.com\",\n  \"password\": \"password123\",\n  \"firstName\": \"John\",\n  \"lastName\": \"Doe\",\n  \"role\": \"STAFF\",\n  \"organizationId\": \"{{organizationId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "register"]
            },
            "description": "Register a new user. Automatically populates user variables and tokens if returned."
          }
        },
        {
          "name": "Refresh Token",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// Auto-update tokens from refresh response",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    ",
                  "    if (response.success && response.data) {",
                  "        if (response.data.tokens) {",
                  "            pm.collectionVariables.set('authToken', response.data.tokens.access);",
                  "            pm.collectionVariables.set('refreshToken', response.data.tokens.refresh);",
                  "            console.log('‚úÖ Tokens refreshed successfully');",
                  "        }",
                  "    }",
                  "}",
                  "",
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Tokens refreshed', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"refreshToken\": \"{{refreshToken}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/refresh",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "refresh"]
            },
            "description": "Refresh JWT tokens using the refresh token. Automatically updates both access and refresh tokens."
          }
        },
        {
          "name": "Logout",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// Clear tokens on successful logout",
                  "if (pm.response.code === 200) {",
                  "    console.log('üîê Logging out - clearing all tokens...');",
                  "    pm.collectionVariables.set('authToken', '');",
                  "    pm.collectionVariables.set('refreshToken', '');",
                  "    pm.collectionVariables.set('userId', '');",
                  "    pm.collectionVariables.set('organizationId', '');",
                  "    console.log('‚úÖ All authentication tokens cleared');",
                  "    console.log('‚ÑπÔ∏è You will need to login again to access protected endpoints');",
                  "}",
                  "",
                  "pm.test('Logout successful', function () {",
                  "    pm.response.to.have.status(200);",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/auth/logout",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "logout"]
            },
            "description": "Logout and clear all authentication tokens. You'll need to login again after this."
          }
        },
        {
          "name": "Change Password",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Password changed successfully', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    console.log('‚úÖ Password changed successfully');",
                  "    console.log('‚ÑπÔ∏è Use your new password for future logins');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"currentPassword\": \"YourCurrentPassword\",\n  \"newPassword\": \"YourNewSecurePassword123!\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/change-password",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "change-password"]
            },
            "description": "Change your own password. Requires current password for verification."
          }
        },
        {
          "name": "Generate API Key",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('API key generated', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.apiKey) {",
                  "        console.log('‚úÖ API Key generated successfully');",
                  "        console.log('üîë API Key: ' + response.data.apiKey);",
                  "        console.log('‚ö†Ô∏è Store this key securely - it will not be shown again!');",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"My API Key\",\n  \"expiresInDays\": 365\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/api-key",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "api-key"]
            },
            "description": "Generate an API key for programmatic access (Admin only). Store the key securely as it will not be shown again."
          }
        }
      ]
    },
    {
      "name": "üè¢ Organizations",
      "description": "Organization management endpoints with automatic ID population",
      "item": [
        {
          "name": "Create Organization (Super Admin)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// Auto-populate organization ID from creation response",
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    ",
                  "    if (response.success && response.data && response.data.organization) {",
                  "        pm.collectionVariables.set('organizationId', response.data.organization.id);",
                  "        console.log('‚úÖ Organization ID updated: ' + response.data.organization.id);",
                  "        console.log('üè¢ Organization created: ' + response.data.organization.name);",
                  "        console.log('üìä Type: ' + response.data.organization.type);",
                  "    }",
                  "}",
                  "",
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Organization created successfully', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data.organization).to.have.property('id');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Acme Microfinance\",\n  \"type\": \"MICROFINANCE\",\n  \"address\": \"123 Business District, City, Country\",\n  \"phone\": \"+1234567890\",\n  \"email\": \"info@acmemicrofinance.com\",\n  \"website\": \"https://acmemicrofinance.com\",\n  \"registrationNumber\": \"REG123456\",\n  \"licenseNumber\": \"LIC789012\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/organizations",
              "host": ["{{baseUrl}}"],
              "path": ["organizations"]
            },
            "description": "Create a new organization (Super Admin only). Automatically populates organizationId variable."
          }
        },
        {
          "name": "List Organizations",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Organizations retrieved', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "// Auto-populate first organization ID if available",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.organizations && response.data.organizations.length > 0) {",
                  "        const firstOrg = response.data.organizations[0];",
                  "        pm.collectionVariables.set('organizationId', firstOrg.id);",
                  "        console.log('‚úÖ First organization ID set: ' + firstOrg.id);",
                  "        console.log('üè¢ Organization: ' + firstOrg.name);",
                  "        console.log('üìä Total organizations: ' + response.data.organizations.length);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/organizations?page=1&limit=10",
              "host": ["{{baseUrl}}"],
              "path": ["organizations"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "10"
                }
              ]
            },
            "description": "List all organizations. Automatically sets organizationId to the first organization."
          }
        },
        {
          "name": "Get Organization by ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Organization retrieved', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data.organization).to.have.property('id');",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.organization) {",
                  "        console.log('üè¢ Organization: ' + response.data.organization.name);",
                  "        console.log('üìä Type: ' + response.data.organization.type);",
                  "        console.log('‚úÖ Active: ' + response.data.organization.isActive);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/organizations/{{organizationId}}",
              "host": ["{{baseUrl}}"],
              "path": ["organizations", "{{organizationId}}"]
            },
            "description": "Get a specific organization by ID"
          }
        },
        {
          "name": "Update Organization",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Organization updated successfully', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.organization) {",
                  "        console.log('‚úÖ Organization updated: ' + response.data.organization.name);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Acme Microfinance Updated\",\n  \"address\": \"456 Business District, New City\",\n  \"phone\": \"+1234567899\",\n  \"email\": \"contact@acmemicrofinance.com\",\n  \"website\": \"https://acmemicrofinance.org\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/organizations/{{organizationId}}",
              "host": ["{{baseUrl}}"],
              "path": ["organizations", "{{organizationId}}"]
            },
            "description": "Update an existing organization (Super Admin or Admin only)"
          }
        },
        {
          "name": "Update Organization Status",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Organization status updated', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.organization) {",
                  "        console.log('‚úÖ Organization status updated');",
                  "        console.log('üè¢ Organization: ' + response.data.organization.name);",
                  "        console.log('üìä Active: ' + response.data.organization.isActive);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"isActive\": true\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/organizations/{{organizationId}}/status",
              "host": ["{{baseUrl}}"],
              "path": ["organizations", "{{organizationId}}", "status"]
            },
            "description": "Activate or deactivate an organization (Super Admin only)"
          }
        },
        {
          "name": "Get Organization Statistics",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Statistics retrieved', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.statistics) {",
                  "        const stats = response.data.statistics;",
                  "        console.log('üìä Organization Statistics:');",
                  "        console.log('üë• Total Users: ' + (stats.totalUsers || 0));",
                  "        console.log('üè¢ Total Branches: ' + (stats.totalBranches || 0));",
                  "        console.log('üë§ Total Clients: ' + (stats.totalClients || 0));",
                  "        console.log('üí∞ Total Loans: ' + (stats.totalLoans || 0));",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/organizations/{{organizationId}}/statistics",
              "host": ["{{baseUrl}}"],
              "path": ["organizations", "{{organizationId}}", "statistics"]
            },
            "description": "Get statistics for a specific organization including user counts, branch counts, client counts, and loan counts"
          }
        }
      ]
    },
    {
      "name": "üë• Client Management",
      "description": "Client management endpoints with automatic ID population",
      "item": [
        {
          "name": "Create Client",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// Auto-populate client ID from creation response",
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    ",
                  "    if (response.success && response.data && response.data.client) {",
                  "        pm.collectionVariables.set('clientId', response.data.client.id);",
                  "        console.log('‚úÖ Client ID updated: ' + response.data.client.id);",
                  "        console.log('‚úÖ Client created: ' + response.data.client.firstName + ' ' + response.data.client.lastName);",
                  "    }",
                  "}",
                  "",
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Client created successfully', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data.client).to.have.property('id');",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"Jane\",\n  \"lastName\": \"Smith\",\n  \"email\": \"jane.smith@example.com\",\n  \"phoneNumber\": \"+1234567890\",\n  \"dateOfBirth\": \"1990-05-15\",\n  \"nationalId\": \"ID123456789\",\n  \"address\": \"123 Main Street, City, Country\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/clients",
              "host": ["{{baseUrl}}"],
              "path": ["clients"]
            },
            "description": "Create a new client. Automatically populates clientId variable with the created client's ID.\\n\\n‚ö†Ô∏è **Multi-Tenant Note**: This endpoint requires an organization context. If you're logged in as a Super Admin, you'll need to:\\n1. First create or select an organization\\n2. The system will automatically scope clients to your organization\\n\\nFor regular users, clients are automatically created within their organization."
          }
        },
        {
          "name": "List Clients",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Clients list retrieved', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "// Auto-populate first client ID if available",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.clients && response.data.clients.length > 0) {",
                  "        const firstClient = response.data.clients[0];",
                  "        pm.collectionVariables.set('clientId', firstClient.id);",
                  "        console.log('‚úÖ First client ID set: ' + firstClient.id);",
                  "        console.log('üìä Total clients found: ' + response.data.clients.length);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/clients?page=1&limit=10",
              "host": ["{{baseUrl}}"],
              "path": ["clients"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "10"
                }
              ]
            },
            "description": "List clients with pagination. Automatically sets clientId to the first client in the list."
          }
        },
        {
          "name": "Get Client by ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Client retrieved', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data.client).to.have.property('id');",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.client) {",
                  "        const client = response.data.client;",
                  "        console.log('üë§ Client: ' + client.firstName + ' ' + client.lastName);",
                  "        console.log('üìß Email: ' + (client.email || 'N/A'));",
                  "        console.log('üìä KYC Status: ' + (client.kycStatus || 'PENDING'));",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/clients/{{clientId}}",
              "host": ["{{baseUrl}}"],
              "path": ["clients", "{{clientId}}"]
            },
            "description": "Get a specific client by ID"
          }
        },
        {
          "name": "Update Client",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Client updated successfully', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.client) {",
                  "        console.log('‚úÖ Client updated: ' + response.data.client.firstName + ' ' + response.data.client.lastName);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"Jane\",\n  \"lastName\": \"Smith-Updated\",\n  \"phoneNumber\": \"+1987654321\",\n  \"address\": \"456 New Street, City, Country\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/clients/{{clientId}}",
              "host": ["{{baseUrl}}"],
              "path": ["clients", "{{clientId}}"]
            },
            "description": "Update an existing client's information"
          }
        },
        {
          "name": "Update Client KYC Status",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('KYC status updated', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.client) {",
                  "        console.log('‚úÖ KYC Status updated');",
                  "        console.log('üë§ Client: ' + response.data.client.firstName + ' ' + response.data.client.lastName);",
                  "        console.log('üìä New Status: ' + response.data.client.kycStatus);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"VERIFIED\",\n  \"notes\": \"All documents verified successfully\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/clients/{{clientId}}/kyc-status",
              "host": ["{{baseUrl}}"],
              "path": ["clients", "{{clientId}}", "kyc-status"]
            },
            "description": "Update client KYC status (Manager or Admin only). Valid statuses: PENDING, VERIFIED, REJECTED"
          }
        },
        {
          "name": "Add KYC Document",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('KYC document added', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "if (pm.response.code === 201) {",
                  "    console.log('‚úÖ KYC document added successfully');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"documentType\": \"NATIONAL_ID\",\n  \"documentNumber\": \"ID123456789\",\n  \"issuedDate\": \"2020-01-15\",\n  \"expiryDate\": \"2030-01-15\",\n  \"documentUrl\": \"https://storage.example.com/docs/id-front.jpg\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/clients/{{clientId}}/kyc-documents",
              "host": ["{{baseUrl}}"],
              "path": ["clients", "{{clientId}}", "kyc-documents"]
            },
            "description": "Add a KYC document to a client's profile. Document types: NATIONAL_ID, PASSPORT, DRIVER_LICENSE, UTILITY_BILL, etc."
          }
        },
        {
          "name": "Get Client Statistics",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Statistics retrieved', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.statistics) {",
                  "        const stats = response.data.statistics;",
                  "        console.log('üìä Client Statistics:');",
                  "        console.log('üë• Total Clients: ' + (stats.totalClients || 0));",
                  "        console.log('‚úÖ Active Clients: ' + (stats.activeClients || 0));",
                  "        console.log('üìã KYC Verified: ' + (stats.verifiedClients || 0));",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/clients/statistics/summary",
              "host": ["{{baseUrl}}"],
              "path": ["clients", "statistics", "summary"]
            },
            "description": "Get client statistics for the organization including total counts, active counts, and KYC status breakdown"
          }
        }
      ]
    },
    {
      "name": "üí∞ Loans & Payments",
      "description": "Loan and payment management endpoints",
      "item": [
        {
          "name": "List Loans",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "// Auto-populate first loan ID if available",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.loans && response.data.loans.length > 0) {",
                  "        const firstLoan = response.data.loans[0];",
                  "        pm.collectionVariables.set('loanId', firstLoan.id);",
                  "        console.log('‚úÖ First loan ID set: ' + firstLoan.id);",
                  "        console.log('üí∞ Loan amount: ' + firstLoan.amount);",
                  "        console.log('üìä Total loans: ' + response.data.loans.length);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loans?page=1&limit=10",
              "host": ["{{baseUrl}}"],
              "path": ["loans"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "10"
                }
              ]
            },
            "description": "List loans with pagination. Automatically sets loanId to the first loan."
          }
        },
        {
          "name": "List Payments",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "// Auto-populate first payment ID if available",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.payments && response.data.payments.length > 0) {",
                  "        const firstPayment = response.data.payments[0];",
                  "        pm.collectionVariables.set('paymentId', firstPayment.id);",
                  "        console.log('‚úÖ First payment ID set: ' + firstPayment.id);",
                  "        console.log('üí≥ Payment amount: ' + firstPayment.amount);",
                  "        console.log('üìä Total payments: ' + response.data.payments.length);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/payments?page=1&limit=10",
              "host": ["{{baseUrl}}"],
              "path": ["payments"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "10"
                }
              ]
            },
            "description": "List payments with pagination. Automatically sets paymentId to the first payment."
          }
        }
      ]
    },
    {
      "name": "üë§ User Management",
      "description": "User management endpoints with CRUD operations",
      "item": [
        {
          "name": "List Users",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Users list retrieved', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.users && response.data.users.length > 0) {",
                  "        const firstUser = response.data.users[0];",
                  "        pm.collectionVariables.set('targetUserId', firstUser.id);",
                  "        console.log('‚úÖ First user ID set as targetUserId: ' + firstUser.id);",
                  "        console.log('üìä Total users found: ' + response.data.users.length);",
                  "        console.log('üìÑ Pagination: Page ' + (response.data.pagination?.page || 1) + ' of ' + (response.data.pagination?.pages || 1));",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/users?page=1&limit=10",
              "host": ["{{baseUrl}}"],
              "path": ["users"],
              "query": [
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "10"
                },
                {
                  "key": "role",
                  "value": "",
                  "disabled": true
                },
                {
                  "key": "isActive",
                  "value": "true",
                  "disabled": true
                },
                {
                  "key": "search",
                  "value": "",
                  "disabled": true
                }
              ]
            },
            "description": "List all users with pagination and filtering options. Enable optional query params to filter by role, active status, or search term."
          }
        },
        {
          "name": "Get User by ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('User retrieved', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data.user).to.have.property('id');",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.user) {",
                  "        const user = response.data.user;",
                  "        console.log('üë§ User: ' + user.firstName + ' ' + user.lastName);",
                  "        console.log('üìß Email: ' + user.email);",
                  "        console.log('üé≠ Role: ' + user.role);",
                  "        console.log('‚úÖ Active: ' + user.isActive);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/users/{{targetUserId}}",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{targetUserId}}"]
            },
            "description": "Get a specific user by ID"
          }
        },
        {
          "name": "Create User",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('User created successfully', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data.user).to.have.property('id');",
                  "});",
                  "",
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.user) {",
                  "        pm.collectionVariables.set('targetUserId', response.data.user.id);",
                  "        console.log('‚úÖ New user created: ' + response.data.user.firstName + ' ' + response.data.user.lastName);",
                  "        console.log('üÜî User ID set as targetUserId: ' + response.data.user.id);",
                  "        console.log('üé≠ Role: ' + response.data.user.role);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"newstaff@microfinex.com\",\n  \"password\": \"SecurePass123!\",\n  \"firstName\": \"New\",\n  \"lastName\": \"Staff\",\n  \"role\": \"STAFF\",\n  \"organizationId\": \"{{organizationId}}\",\n  \"phone\": \"+1234567890\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users",
              "host": ["{{baseUrl}}"],
              "path": ["users"]
            },
            "description": "Create a new user (Admin, Manager, or Super Admin only). Available roles: SUPER_ADMIN, ADMIN, ORG_ADMIN, MANAGER, LOAN_OFFICER, ACCOUNTANT, TELLER, STAFF"
          }
        },
        {
          "name": "Update User",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('User updated successfully', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.user) {",
                  "        console.log('‚úÖ User updated: ' + response.data.user.firstName + ' ' + response.data.user.lastName);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"firstName\": \"Updated\",\n  \"lastName\": \"User\",\n  \"phone\": \"+1987654321\",\n  \"role\": \"LOAN_OFFICER\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users/{{targetUserId}}",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{targetUserId}}"]
            },
            "description": "Update an existing user's information"
          }
        },
        {
          "name": "Update User Status",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('User status updated', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.user) {",
                  "        console.log('‚úÖ User status updated');",
                  "        console.log('üë§ User: ' + response.data.user.firstName + ' ' + response.data.user.lastName);",
                  "        console.log('üìä Active: ' + response.data.user.isActive);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"isActive\": true\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users/{{targetUserId}}/status",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{targetUserId}}", "status"]
            },
            "description": "Activate or deactivate a user (Admin only)"
          }
        },
        {
          "name": "Assign User to Branch",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('User assigned to branch', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.user) {",
                  "        console.log('‚úÖ User assigned to branch');",
                  "        console.log('üë§ User: ' + response.data.user.firstName + ' ' + response.data.user.lastName);",
                  "        console.log('üè¢ Branch ID: ' + (response.data.user.branchId || 'None'));",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"branchId\": \"{{branchId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users/{{targetUserId}}/branch",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{targetUserId}}", "branch"]
            },
            "description": "Assign or reassign a user to a specific branch. Set branchId to null to remove from branch."
          }
        },
        {
          "name": "Reset User Password",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Password reset successful', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    console.log('‚úÖ User password has been reset');",
                  "    console.log('‚ÑπÔ∏è User will need to use the new password to login');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"newPassword\": \"NewSecurePassword123!\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/users/{{targetUserId}}/reset-password",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{targetUserId}}", "reset-password"]
            },
            "description": "Reset a user's password (Admin action). The user will need to use the new password to login."
          }
        },
        {
          "name": "Get User Statistics",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Statistics retrieved', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.statistics) {",
                  "        const stats = response.data.statistics;",
                  "        console.log('üìä User Statistics:');",
                  "        console.log('üë• Total Users: ' + (stats.totalUsers || 0));",
                  "        console.log('‚úÖ Active Users: ' + (stats.activeUsers || 0));",
                  "        console.log('‚ùå Inactive Users: ' + (stats.inactiveUsers || 0));",
                  "        if (stats.byRole) {",
                  "            console.log('üëî By Role: ' + JSON.stringify(stats.byRole));",
                  "        }",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/users/statistics",
              "host": ["{{baseUrl}}"],
              "path": ["users", "statistics"]
            },
            "description": "Get user statistics including total counts, active/inactive counts, and counts by role (Admin or Manager only)"
          }
        },
        {
          "name": "Delete User",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200 or 204', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 204]);",
                  "});",
                  "",
                  "if (pm.response.code === 200 || pm.response.code === 204) {",
                  "    console.log('‚úÖ User deleted successfully');",
                  "    pm.collectionVariables.set('targetUserId', '');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/users/{{targetUserId}}",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{targetUserId}}"]
            },
            "description": "Delete a user (Admin only). This is typically a soft delete."
          }
        },
        {
          "name": "Get Current User Profile",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('User profile retrieved', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data.user).to.have.property('id');",
                  "});",
                  "",
                  "// Log user profile info",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.user) {",
                  "        const user = response.data.user;",
                  "        console.log('üë§ Current user: ' + user.firstName + ' ' + user.lastName);",
                  "        console.log('üìß Email: ' + user.email);",
                  "        console.log('üé≠ Role: ' + user.role);",
                  "        if (user.organization) {",
                  "            console.log('üè¢ Organization: ' + user.organization.name);",
                  "        } else {",
                  "            console.log('üëë Super Admin - No organization restriction');",
                  "        }",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/auth/me",
              "host": ["{{baseUrl}}"],
              "path": ["auth", "me"]
            },
            "description": "Get the current user's profile information including role and organization."
          }
        },
        {
          "name": "Get Users Pending Verification",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data) {",
                  "        console.log('üìã Users pending verification: ' + response.data.count);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/users/pending-verification",
              "host": ["{{baseUrl}}"],
              "path": ["users", "pending-verification"]
            },
            "description": "Get all users who have not yet verified their email. Super Admin sees all users, Admins see only their organization's users."
          }
        },
        {
          "name": "Verify User Email (Super Admin)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.user) {",
                  "        console.log('‚úÖ Email verified for: ' + response.data.user.email);",
                  "        console.log('üîê isEmailVerified: ' + response.data.user.isEmailVerified);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/users/{{targetUserId}}/verify-email",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{targetUserId}}", "verify-email"]
            },
            "description": "Manually verify a user's email address (Super Admin only). This bypasses email verification and allows the user to access the system immediately."
          }
        },
        {
          "name": "Unverify User Email (Super Admin)",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.user) {",
                  "        console.log('‚ùå Email verification revoked for: ' + response.data.user.email);",
                  "        console.log('üîê isEmailVerified: ' + response.data.user.isEmailVerified);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/users/{{targetUserId}}/unverify-email",
              "host": ["{{baseUrl}}"],
              "path": ["users", "{{targetUserId}}", "unverify-email"]
            },
            "description": "Revoke a user's email verification (Super Admin only). This will require the user to verify their email again."
          }
        }
      ]
    },
    {
      "name": "‚öôÔ∏è Settings",
      "description": "Organization settings management endpoints",
      "item": [
        {
          "name": "Get All Settings",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/settings",
              "host": ["{{baseUrl}}"],
              "path": ["settings"]
            },
            "description": "Get all settings for the organization"
          }
        },
        {
          "name": "Get Single Setting",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/settings/:key",
              "host": ["{{baseUrl}}"],
              "path": ["settings", ":key"],
              "variable": [
                {
                  "key": "key",
                  "value": "default_currency"
                }
              ]
            },
            "description": "Get a specific setting by key"
          }
        },
        {
          "name": "Update Setting",
          "request": {
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"settingValue\": \"USD\",\n  \"description\": \"Default currency for the organization\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/settings/:key",
              "host": ["{{baseUrl}}"],
              "path": ["settings", ":key"],
              "variable": [
                {
                  "key": "key",
                  "value": "default_currency"
                }
              ]
            },
            "description": "Update a setting value"
          }
        },
        {
          "name": "Reset Setting",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/settings/reset/:key",
              "host": ["{{baseUrl}}"],
              "path": ["settings", "reset", ":key"],
              "variable": [
                {
                  "key": "key",
                  "value": "default_currency"
                }
              ]
            },
            "description": "Reset a setting to its default value"
          }
        }
      ]
    },
    {
      "name": "üí± Exchange Rates",
      "description": "Currency exchange rate management endpoints",
      "item": [
        {
          "name": "Get Current Rates",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/exchange-rates",
              "host": ["{{baseUrl}}"],
              "path": ["exchange-rates"]
            },
            "description": "Get all current exchange rates for the organization"
          }
        },
        {
          "name": "Set Exchange Rate",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"fromCurrency\": \"USD\",\n  \"toCurrency\": \"ZWG\",\n  \"rate\": 15.5,\n  \"effectiveDate\": \"2024-01-01T00:00:00Z\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/exchange-rates",
              "host": ["{{baseUrl}}"],
              "path": ["exchange-rates"]
            },
            "description": "Set a new exchange rate between two currencies"
          }
        },
        {
          "name": "Get Rate History",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/exchange-rates/history?from=USD&to=ZWG",
              "host": ["{{baseUrl}}"],
              "path": ["exchange-rates", "history"],
              "query": [
                { "key": "from", "value": "USD" },
                { "key": "to", "value": "ZWG" }
              ]
            },
            "description": "Get historical exchange rates between two currencies"
          }
        },
        {
          "name": "Convert Currency",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/exchange-rates/convert?amount=100&from=USD&to=ZWG",
              "host": ["{{baseUrl}}"],
              "path": ["exchange-rates", "convert"],
              "query": [
                { "key": "amount", "value": "100" },
                { "key": "from", "value": "USD" },
                { "key": "to", "value": "ZWG" }
              ]
            },
            "description": "Convert an amount between two currencies using current rate"
          }
        }
      ]
    },
    {
      "name": "üìÇ Loan Categories",
      "description": "Loan category management endpoints",
      "item": [
        {
          "name": "Get All Loan Categories",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.categories && response.data.categories.length > 0) {",
                  "        pm.collectionVariables.set('categoryId', response.data.categories[0].id);",
                  "        console.log('‚úÖ Category ID set: ' + response.data.categories[0].id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-categories",
              "host": ["{{baseUrl}}"],
              "path": ["loan-categories"]
            },
            "description": "Get all loan categories for the organization"
          }
        },
        {
          "name": "Get Single Loan Category",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-categories/{{categoryId}}",
              "host": ["{{baseUrl}}"],
              "path": ["loan-categories", "{{categoryId}}"]
            },
            "description": "Get a specific loan category by ID"
          }
        },
        {
          "name": "Create Loan Category",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.category) {",
                  "        pm.collectionVariables.set('categoryId', response.data.category.id);",
                  "        console.log('‚úÖ New Category ID set: ' + response.data.category.id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Personal Loans\",\n  \"code\": \"PERSONAL\",\n  \"description\": \"Standard personal loans for individual clients\",\n  \"isLongTerm\": false,\n  \"requiresBusinessVisit\": false,\n  \"requiresHomeVisit\": true,\n  \"requiresSecurityPledge\": false,\n  \"requiresCollateral\": false\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-categories",
              "host": ["{{baseUrl}}"],
              "path": ["loan-categories"]
            },
            "description": "Create a new loan category"
          }
        },
        {
          "name": "Update Loan Category",
          "request": {
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Personal Loans Updated\",\n  \"description\": \"Updated description for personal loans\",\n  \"requiresHomeVisit\": false\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-categories/{{categoryId}}",
              "host": ["{{baseUrl}}"],
              "path": ["loan-categories", "{{categoryId}}"]
            },
            "description": "Update an existing loan category"
          }
        },
        {
          "name": "Delete Loan Category",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-categories/{{categoryId}}",
              "host": ["{{baseUrl}}"],
              "path": ["loan-categories", "{{categoryId}}"]
            },
            "description": "Delete a loan category (soft delete)"
          }
        }
      ]
    },
    {
      "name": "üì¶ Loan Products",
      "description": "Loan product management endpoints",
      "item": [
        {
          "name": "Get All Loan Products",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.products && response.data.products.length > 0) {",
                  "        pm.collectionVariables.set('productId', response.data.products[0].id);",
                  "        console.log('‚úÖ Product ID set: ' + response.data.products[0].id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-products",
              "host": ["{{baseUrl}}"],
              "path": ["loan-products"]
            },
            "description": "Get all loan products for the organization"
          }
        },
        {
          "name": "Get Loan Products by Category",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-products?categoryId={{categoryId}}",
              "host": ["{{baseUrl}}"],
              "path": ["loan-products"],
              "query": [{ "key": "categoryId", "value": "{{categoryId}}" }]
            },
            "description": "Get loan products filtered by category"
          }
        },
        {
          "name": "Get Active Loan Products",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-products?isActive=true",
              "host": ["{{baseUrl}}"],
              "path": ["loan-products"],
              "query": [{ "key": "isActive", "value": "true" }]
            },
            "description": "Get all active loan products"
          }
        },
        {
          "name": "Get Products for Calculator",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-products/calculator",
              "host": ["{{baseUrl}}"],
              "path": ["loan-products", "calculator"]
            },
            "description": "Get loan products formatted for loan calculator"
          }
        },
        {
          "name": "Get Single Loan Product",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-products/{{productId}}",
              "host": ["{{baseUrl}}"],
              "path": ["loan-products", "{{productId}}"]
            },
            "description": "Get a specific loan product by ID"
          }
        },
        {
          "name": "Create Loan Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.product) {",
                  "        pm.collectionVariables.set('productId', response.data.product.id);",
                  "        console.log('‚úÖ New Product ID set: ' + response.data.product.id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Quick Personal Loan\",\n  \"description\": \"Short-term personal loan with quick approval\",\n  \"type\": \"PERSONAL\",\n  \"categoryId\": \"{{categoryId}}\",\n  \"minAmount\": 100,\n  \"maxAmount\": 5000,\n  \"currency\": \"USD\",\n  \"interestRate\": 0.15,\n  \"calculationMethod\": \"REDUCING_BALANCE\",\n  \"minTerm\": 1,\n  \"maxTerm\": 12,\n  \"repaymentFrequency\": \"MONTHLY\",\n  \"gracePeriod\": 0,\n  \"penaltyRate\": 0.05,\n  \"requiresCollateral\": false,\n  \"requiresGuarantor\": false,\n  \"isOnlineEligible\": true\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-products",
              "host": ["{{baseUrl}}"],
              "path": ["loan-products"]
            },
            "description": "Create a new loan product"
          }
        },
        {
          "name": "Update Loan Product",
          "request": {
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Quick Personal Loan - Updated\",\n  \"maxAmount\": 10000,\n  \"interestRate\": 0.12,\n  \"isActive\": true\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-products/{{productId}}",
              "host": ["{{baseUrl}}"],
              "path": ["loan-products", "{{productId}}"]
            },
            "description": "Update an existing loan product"
          }
        },
        {
          "name": "Duplicate Loan Product",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Quick Personal Loan - Copy\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-products/{{productId}}/duplicate",
              "host": ["{{baseUrl}}"],
              "path": ["loan-products", "{{productId}}", "duplicate"]
            },
            "description": "Duplicate an existing loan product with a new name"
          }
        },
        {
          "name": "Delete Loan Product",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-products/{{productId}}",
              "host": ["{{baseUrl}}"],
              "path": ["loan-products", "{{productId}}"]
            },
            "description": "Delete a loan product (soft delete)"
          }
        }
      ]
    },
    {
      "name": "üìã Loan Workflow",
      "description": "Loan assessment, visits, pledges, and status management endpoints",
      "item": [
        {
          "name": "Get Loan Assessment",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/loans/{{loanId}}/assessment",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "loans", "{{loanId}}", "assessment"]
            },
            "description": "Get assessment details for a specific loan"
          }
        },
        {
          "name": "Create/Update Assessment",
          "request": {
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clientCharacter\": \"GOOD\",\n  \"clientCapacity\": \"ADEQUATE\",\n  \"collateralQuality\": \"SATISFACTORY\",\n  \"conditions\": \"FAVORABLE\",\n  \"capitalAdequacy\": \"ADEQUATE\",\n  \"recommendedAmount\": 5000,\n  \"notes\": \"Client has good repayment history\",\n  \"recommendation\": \"APPROVED\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/loans/{{loanId}}/assessment",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "loans", "{{loanId}}", "assessment"]
            },
            "description": "Create or update assessment for a loan"
          }
        },
        {
          "name": "List Loan Visits",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/loans/{{loanId}}/visits",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "loans", "{{loanId}}", "visits"]
            },
            "description": "Get all visits for a specific loan"
          }
        },
        {
          "name": "Create Visit",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"visitType\": \"HOME\",\n  \"scheduledDate\": \"2024-12-01T10:00:00Z\",\n  \"purpose\": \"Initial assessment visit\",\n  \"address\": \"123 Main Street\",\n  \"notes\": \"Client requested morning visit\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/loans/{{loanId}}/visits",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "loans", "{{loanId}}", "visits"]
            },
            "description": "Schedule a new visit for a loan"
          }
        },
        {
          "name": "Update Visit",
          "request": {
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"COMPLETED\",\n  \"actualDate\": \"2024-12-01T11:00:00Z\",\n  \"findings\": \"Client resides at stated address, property verified\",\n  \"outcome\": \"POSITIVE\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/visits/{{visitId}}",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "visits", "{{visitId}}"]
            },
            "description": "Update visit details and status"
          }
        },
        {
          "name": "List Loan Pledges",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/loans/{{loanId}}/pledges",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "loans", "{{loanId}}", "pledges"]
            },
            "description": "Get all pledges/collateral for a loan"
          }
        },
        {
          "name": "Create Pledge",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"pledgeType\": \"VEHICLE\",\n  \"description\": \"2020 Toyota Corolla\",\n  \"estimatedValue\": 15000,\n  \"location\": \"Client premises\",\n  \"registrationNumber\": \"ABC 123 GP\",\n  \"notes\": \"Vehicle in good condition\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/loans/{{loanId}}/pledges",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "loans", "{{loanId}}", "pledges"]
            },
            "description": "Add a pledge/collateral to a loan"
          }
        },
        {
          "name": "Update Pledge",
          "request": {
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"VERIFIED\",\n  \"verifiedValue\": 14500,\n  \"verificationNotes\": \"Value confirmed by independent assessor\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/pledges/{{pledgeId}}",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "pledges", "{{pledgeId}}"]
            },
            "description": "Update pledge details and verification status"
          }
        },
        {
          "name": "Get Loan Status History",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/loans/{{loanId}}/status-history",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "loans", "{{loanId}}", "status-history"]
            },
            "description": "Get complete status transition history for a loan"
          }
        },
        {
          "name": "Transition Loan Status",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"newStatus\": \"APPROVED\",\n  \"notes\": \"All requirements verified, loan approved for disbursement\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/loans/{{loanId}}/transition",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "loans", "{{loanId}}", "transition"]
            },
            "description": "Transition a loan to a new status (PENDING ‚Üí UNDER_REVIEW ‚Üí APPROVED ‚Üí DISBURSED ‚Üí ACTIVE, etc.)"
          }
        }
      ]
    },
    {
      "name": "üè™ Shops & Products",
      "description": "Shop management and product catalog endpoints",
      "item": [
        {
          "name": "List Shops",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.shops && response.data.shops.length > 0) {",
                  "        pm.collectionVariables.set('shopId', response.data.shops[0].id);",
                  "        console.log('‚úÖ Shop ID set: ' + response.data.shops[0].id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/shops",
              "host": ["{{baseUrl}}"],
              "path": ["shops"]
            },
            "description": "Get all shops for the organization"
          }
        },
        {
          "name": "Create Shop",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.shop) {",
                  "        pm.collectionVariables.set('shopId', response.data.shop.id);",
                  "        console.log('‚úÖ New Shop ID set: ' + response.data.shop.id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Downtown Electronics\",\n  \"address\": \"123 Main Street, City Center\",\n  \"phone\": \"+1234567890\",\n  \"contactPerson\": \"John Smith\",\n  \"bankAccount\": \"1234567890\",\n  \"mobileNumber\": \"+1234567891\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/shops",
              "host": ["{{baseUrl}}"],
              "path": ["shops"]
            },
            "description": "Create a new shop in the organization"
          }
        },
        {
          "name": "Get Shop by ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/shops/{{shopId}}",
              "host": ["{{baseUrl}}"],
              "path": ["shops", "{{shopId}}"]
            },
            "description": "Get details of a specific shop"
          }
        },
        {
          "name": "Update Shop",
          "request": {
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Downtown Electronics Plus\",\n  \"phone\": \"+1234567899\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/shops/{{shopId}}",
              "host": ["{{baseUrl}}"],
              "path": ["shops", "{{shopId}}"]
            },
            "description": "Update shop details"
          }
        },
        {
          "name": "Delete Shop",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/shops/{{shopId}}",
              "host": ["{{baseUrl}}"],
              "path": ["shops", "{{shopId}}"]
            },
            "description": "Delete a shop (soft delete)"
          }
        },
        {
          "name": "Get Shop Statistics",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/shops/{{shopId}}/stats",
              "host": ["{{baseUrl}}"],
              "path": ["shops", "{{shopId}}", "stats"]
            },
            "description": "Get statistics for a specific shop"
          }
        },
        {
          "name": "List Shop Products",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.products && response.data.products.length > 0) {",
                  "        pm.collectionVariables.set('shopProductId', response.data.products[0].id);",
                  "        console.log('‚úÖ Shop Product ID set: ' + response.data.products[0].id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/shops/{{shopId}}/products",
              "host": ["{{baseUrl}}"],
              "path": ["shops", "{{shopId}}", "products"]
            },
            "description": "Get all products for a specific shop"
          }
        },
        {
          "name": "Create Shop Product",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.product) {",
                  "        pm.collectionVariables.set('shopProductId', response.data.product.id);",
                  "        console.log('‚úÖ New Shop Product ID set: ' + response.data.product.id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Samsung Galaxy S24\",\n  \"description\": \"Latest Samsung flagship smartphone\",\n  \"price\": 999.99,\n  \"currency\": \"USD\",\n  \"sku\": \"SAM-S24-001\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/shops/{{shopId}}/products",
              "host": ["{{baseUrl}}"],
              "path": ["shops", "{{shopId}}", "products"]
            },
            "description": "Add a new product to a shop"
          }
        },
        {
          "name": "Update Shop Product",
          "request": {
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"price\": 949.99,\n  \"description\": \"Samsung Galaxy S24 - Sale Price\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/shops/products/{{shopProductId}}",
              "host": ["{{baseUrl}}"],
              "path": ["shops", "products", "{{shopProductId}}"]
            },
            "description": "Update product details"
          }
        },
        {
          "name": "Delete Shop Product",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/shops/products/{{shopProductId}}",
              "host": ["{{baseUrl}}"],
              "path": ["shops", "products", "{{shopProductId}}"]
            },
            "description": "Delete a product from a shop"
          }
        }
      ]
    },
    {
      "name": "üõí Loan Items",
      "description": "Loan items management - products associated with loans",
      "item": [
        {
          "name": "Add Item to Loan",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.loanItem) {",
                  "        pm.collectionVariables.set('loanItemId', response.data.loanItem.id);",
                  "        console.log('‚úÖ Loan Item ID set: ' + response.data.loanItem.id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"shopProductId\": \"{{shopProductId}}\",\n  \"quantity\": 1,\n  \"unitPrice\": 999.99\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-items/loans/{{loanId}}/items",
              "host": ["{{baseUrl}}"],
              "path": ["loan-items", "loans", "{{loanId}}", "items"]
            },
            "description": "Add a product item to a loan"
          }
        },
        {
          "name": "Get Loan Items",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-items/loans/{{loanId}}/items",
              "host": ["{{baseUrl}}"],
              "path": ["loan-items", "loans", "{{loanId}}", "items"]
            },
            "description": "Get all items for a specific loan"
          }
        },
        {
          "name": "Remove Item from Loan",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-items/items/{{loanItemId}}",
              "host": ["{{baseUrl}}"],
              "path": ["loan-items", "items", "{{loanItemId}}"]
            },
            "description": "Remove an item from a loan"
          }
        },
        {
          "name": "Get Loan Total Value",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-items/loans/{{loanId}}/total",
              "host": ["{{baseUrl}}"],
              "path": ["loan-items", "loans", "{{loanId}}", "total"]
            },
            "description": "Get the total value of all items on a loan"
          }
        },
        {
          "name": "Get Shop Sales Statistics",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-items/shops/{{shopId}}/sales-stats?startDate=2024-01-01&endDate=2024-12-31",
              "host": ["{{baseUrl}}"],
              "path": ["loan-items", "shops", "{{shopId}}", "sales-stats"],
              "query": [
                { "key": "startDate", "value": "2024-01-01" },
                { "key": "endDate", "value": "2024-12-31" }
              ]
            },
            "description": "Get sales statistics for a shop"
          }
        }
      ]
    },
    {
      "name": "üì± Online Applications",
      "description": "Online loan application management endpoints",
      "item": [
        {
          "name": "List Applications",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.applications && response.data.applications.length > 0) {",
                  "        pm.collectionVariables.set('applicationId', response.data.applications[0].id);",
                  "        console.log('‚úÖ Application ID set: ' + response.data.applications[0].id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/online-applications?status=PENDING",
              "host": ["{{baseUrl}}"],
              "path": ["online-applications"],
              "query": [{ "key": "status", "value": "PENDING" }]
            },
            "description": "Get all online applications with optional filters"
          }
        },
        {
          "name": "Create Application",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.application) {",
                  "        pm.collectionVariables.set('applicationId', response.data.application.id);",
                  "        console.log('‚úÖ New Application ID set: ' + response.data.application.id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"source\": \"WEB\",\n  \"applicationType\": \"NEW\",\n  \"clientPhone\": \"+263771234567\",\n  \"clientName\": \"Jane Doe\",\n  \"idNumber\": \"63-123456A78\",\n  \"amount\": 5000,\n  \"productId\": \"{{productId}}\",\n  \"disbursementPreference\": \"CASH\",\n  \"notes\": \"Urgent loan request for business expansion\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/online-applications",
              "host": ["{{baseUrl}}"],
              "path": ["online-applications"]
            },
            "description": "Submit a new online loan application"
          }
        },
        {
          "name": "Get Application by ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/online-applications/{{applicationId}}",
              "host": ["{{baseUrl}}"],
              "path": ["online-applications", "{{applicationId}}"]
            },
            "description": "Get details of a specific application"
          }
        },
        {
          "name": "Update Application",
          "request": {
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"amount\": 6000,\n  \"notes\": \"Amount adjusted based on client request\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/online-applications/{{applicationId}}",
              "host": ["{{baseUrl}}"],
              "path": ["online-applications", "{{applicationId}}"]
            },
            "description": "Update application details"
          }
        },
        {
          "name": "Verify Application",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"notes\": \"Identity verified, documents confirmed\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/online-applications/{{applicationId}}/verify",
              "host": ["{{baseUrl}}"],
              "path": ["online-applications", "{{applicationId}}", "verify"]
            },
            "description": "Mark an application as verified"
          }
        },
        {
          "name": "Convert Application to Loan",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clientId\": \"{{clientId}}\",\n  \"loanOfficerId\": \"{{userId}}\",\n  \"branchId\": \"{{branchId}}\",\n  \"interestRate\": 15,\n  \"term\": 12,\n  \"repaymentFrequency\": \"MONTHLY\",\n  \"purpose\": \"Business expansion\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/online-applications/{{applicationId}}/convert-to-loan",
              "host": ["{{baseUrl}}"],
              "path": [
                "online-applications",
                "{{applicationId}}",
                "convert-to-loan"
              ]
            },
            "description": "Convert a verified application into a loan. Required: clientId, loanOfficerId, branchId, interestRate, term, repaymentFrequency"
          }
        },
        {
          "name": "Update Application Status",
          "request": {
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"REJECTED\",\n  \"notes\": \"Application rejected due to incomplete documentation\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/online-applications/{{applicationId}}/status",
              "host": ["{{baseUrl}}"],
              "path": ["online-applications", "{{applicationId}}", "status"]
            },
            "description": "Update application status (PENDING, VERIFIED, PROCESSED, EXPIRED, REJECTED)"
          }
        },
        {
          "name": "Get Application Statistics",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/online-applications/stats?startDate=2024-01-01&endDate=2024-12-31",
              "host": ["{{baseUrl}}"],
              "path": ["online-applications", "stats"],
              "query": [
                { "key": "startDate", "value": "2024-01-01" },
                { "key": "endDate", "value": "2024-12-31" }
              ]
            },
            "description": "Get application statistics for the organization"
          }
        }
      ]
    },
    {
      "name": "üîê Roles & Permissions (RBAC)",
      "description": "Role-Based Access Control management endpoints for permissions, roles, and user assignments",
      "item": [
        {
          "name": "Get All Permissions",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.permissions) {",
                  "        console.log('üìã Total permissions: ' + response.data.permissions.length);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/roles/permissions",
              "host": ["{{baseUrl}}"],
              "path": ["roles", "permissions"]
            },
            "description": "Get all available permissions in the system"
          }
        },
        {
          "name": "Seed Permissions",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200 or 201', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([200, 201]);",
                  "});",
                  "",
                  "if (pm.response.code === 200 || pm.response.code === 201) {",
                  "    console.log('‚úÖ Permissions seeded successfully');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/roles/permissions/seed",
              "host": ["{{baseUrl}}"],
              "path": ["roles", "permissions", "seed"]
            },
            "description": "Seed all default permissions (Super Admin only). Creates 120+ granular permissions across 22 modules."
          }
        },
        {
          "name": "Get Permissions by Module",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/roles/permissions?module=clients",
              "host": ["{{baseUrl}}"],
              "path": ["roles", "permissions"],
              "query": [{ "key": "module", "value": "clients" }]
            },
            "description": "Get permissions filtered by module. Available modules: users, clients, loans, payments, organizations, branches, roles, audit, settings, reports, etc."
          }
        },
        {
          "name": "Create Role",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.role) {",
                  "        pm.collectionVariables.set('roleId', response.data.role.id);",
                  "        console.log('‚úÖ Role created: ' + response.data.role.name);",
                  "        console.log('üÜî Role ID set: ' + response.data.role.id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Custom Loan Officer\",\n  \"description\": \"Custom role with specific loan management permissions\",\n  \"permissions\": [\n    \"clients.view\",\n    \"clients.create\",\n    \"loans.view\",\n    \"loans.create\",\n    \"loans.approve\",\n    \"payments.view\",\n    \"payments.create\"\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/roles/organization/{{organizationId}}",
              "host": ["{{baseUrl}}"],
              "path": ["roles", "organization", "{{organizationId}}"]
            },
            "description": "Create a new custom role for the organization with specified permissions"
          }
        },
        {
          "name": "Get Roles by Organization",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.roles && response.data.roles.length > 0) {",
                  "        pm.collectionVariables.set('roleId', response.data.roles[0].id);",
                  "        console.log('üìã Total roles: ' + response.data.roles.length);",
                  "        console.log('‚úÖ First role ID set: ' + response.data.roles[0].id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/roles/organization/{{organizationId}}",
              "host": ["{{baseUrl}}"],
              "path": ["roles", "organization", "{{organizationId}}"]
            },
            "description": "Get all roles for an organization including system and custom roles"
          }
        },
        {
          "name": "Get Role by ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/roles/{{roleId}}",
              "host": ["{{baseUrl}}"],
              "path": ["roles", "{{roleId}}"]
            },
            "description": "Get detailed information about a specific role including its permissions"
          }
        },
        {
          "name": "Update Role",
          "request": {
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Senior Loan Officer\",\n  \"description\": \"Updated role with additional permissions\",\n  \"isActive\": true\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/roles/{{roleId}}",
              "host": ["{{baseUrl}}"],
              "path": ["roles", "{{roleId}}"]
            },
            "description": "Update a custom role's name, description, or status"
          }
        },
        {
          "name": "Delete Role",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/roles/{{roleId}}",
              "host": ["{{baseUrl}}"],
              "path": ["roles", "{{roleId}}"]
            },
            "description": "Delete a custom role (cannot delete system roles)"
          }
        },
        {
          "name": "Update Role Permissions",
          "request": {
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"permissions\": [\n    \"clients.view\",\n    \"clients.create\",\n    \"clients.update\",\n    \"loans.view\",\n    \"loans.create\",\n    \"loans.update\",\n    \"loans.approve\",\n    \"loans.disburse\",\n    \"payments.view\",\n    \"payments.create\"\n  ]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/roles/{{roleId}}/permissions",
              "host": ["{{baseUrl}}"],
              "path": ["roles", "{{roleId}}", "permissions"]
            },
            "description": "Replace all permissions for a role with a new set of permissions"
          }
        },
        {
          "name": "Get Role Users",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/roles/{{roleId}}/users",
              "host": ["{{baseUrl}}"],
              "path": ["roles", "{{roleId}}", "users"]
            },
            "description": "Get all users assigned to a specific role"
          }
        },
        {
          "name": "Get User Roles",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/roles/user/{{targetUserId}}/roles",
              "host": ["{{baseUrl}}"],
              "path": ["roles", "user", "{{targetUserId}}", "roles"]
            },
            "description": "Get all roles assigned to a specific user"
          }
        },
        {
          "name": "Assign Role to User",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"roleId\": \"{{roleId}}\",\n  \"expiresAt\": null\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/roles/user/{{targetUserId}}/assign",
              "host": ["{{baseUrl}}"],
              "path": ["roles", "user", "{{targetUserId}}", "assign"]
            },
            "description": "Assign a role to a user. Optionally set an expiration date for temporary assignments."
          }
        },
        {
          "name": "Remove Role from User",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/roles/user/{{targetUserId}}/role/{{roleId}}",
              "host": ["{{baseUrl}}"],
              "path": [
                "roles",
                "user",
                "{{targetUserId}}",
                "role",
                "{{roleId}}"
              ]
            },
            "description": "Remove a role assignment from a user"
          }
        },
        {
          "name": "Get User Direct Permissions",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/roles/user/{{targetUserId}}/permissions",
              "host": ["{{baseUrl}}"],
              "path": ["roles", "user", "{{targetUserId}}", "permissions"]
            },
            "description": "Get permissions directly assigned to a user (not from roles)"
          }
        },
        {
          "name": "Set User Direct Permission",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"permissionCode\": \"reports.financial.view\",\n  \"expiresAt\": null\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/roles/user/{{targetUserId}}/permissions",
              "host": ["{{baseUrl}}"],
              "path": ["roles", "user", "{{targetUserId}}", "permissions"]
            },
            "description": "Grant a specific permission directly to a user (independent of roles)"
          }
        },
        {
          "name": "Remove User Direct Permission",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/roles/user/{{targetUserId}}/permissions/reports.financial.view",
              "host": ["{{baseUrl}}"],
              "path": [
                "roles",
                "user",
                "{{targetUserId}}",
                "permissions",
                "reports.financial.view"
              ]
            },
            "description": "Remove a directly assigned permission from a user"
          }
        },
        {
          "name": "Get User Effective Permissions",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.permissions) {",
                  "        console.log('üîê Total effective permissions: ' + response.data.permissions.length);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/roles/user/{{targetUserId}}/permissions/effective",
              "host": ["{{baseUrl}}"],
              "path": [
                "roles",
                "user",
                "{{targetUserId}}",
                "permissions",
                "effective"
              ]
            },
            "description": "Get all effective permissions for a user (combined from roles + direct assignments)"
          }
        },
        {
          "name": "Seed Default Roles",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/roles/organization/{{organizationId}}/seed-defaults",
              "host": ["{{baseUrl}}"],
              "path": [
                "roles",
                "organization",
                "{{organizationId}}",
                "seed-defaults"
              ]
            },
            "description": "Seed default roles for an organization (ORG_ADMIN, MANAGER, LOAN_OFFICER, TELLER, etc.)"
          }
        }
      ]
    },
    {
      "name": "üìú Audit Trail",
      "description": "Advanced audit logging and compliance tracking endpoints",
      "item": [
        {
          "name": "Search Audit Logs",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data) {",
                  "        console.log('üìã Audit logs found: ' + (response.data.logs?.length || 0));",
                  "        console.log('üìÑ Total records: ' + (response.data.total || 0));",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit/logs?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["audit", "logs"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "20" },
                { "key": "action", "value": "", "disabled": true },
                { "key": "resource", "value": "", "disabled": true },
                { "key": "userId", "value": "", "disabled": true },
                { "key": "status", "value": "", "disabled": true },
                { "key": "startDate", "value": "", "disabled": true },
                { "key": "endDate", "value": "", "disabled": true }
              ]
            },
            "description": "Search and filter audit logs with pagination. Filter by action (CREATE, READ, UPDATE, DELETE, LOGIN, LOGOUT), resource type, user, status, and date range."
          }
        },
        {
          "name": "Get Audit Log by ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit/logs/:logId",
              "host": ["{{baseUrl}}"],
              "path": ["audit", "logs", ":logId"],
              "variable": [{ "key": "logId", "value": "" }]
            },
            "description": "Get detailed information about a specific audit log entry including changes diff"
          }
        },
        {
          "name": "Get My Activity",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.activities) {",
                  "        console.log('üìã Your recent activities: ' + response.data.activities.length);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit/me/activity?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["audit", "me", "activity"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "20" }
              ]
            },
            "description": "Get your own activity history"
          }
        },
        {
          "name": "Get User Activity",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit/users/{{targetUserId}}/activity?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["audit", "users", "{{targetUserId}}", "activity"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "20" }
              ]
            },
            "description": "Get activity history for a specific user (Admin only)"
          }
        },
        {
          "name": "Get Entity History",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.history) {",
                  "        console.log('üìã Entity history entries: ' + response.data.history.length);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit/history/Client/{{clientId}}",
              "host": ["{{baseUrl}}"],
              "path": ["audit", "history", "Client", "{{clientId}}"]
            },
            "description": "Get complete change history for a specific entity. Resource types: Client, Loan, Payment, User, Organization, etc."
          }
        },
        {
          "name": "Get Audit Statistics",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.stats) {",
                  "        const stats = response.data.stats;",
                  "        console.log('üìä Audit Statistics:');",
                  "        console.log('üìù Total logs: ' + (stats.totalLogs || 0));",
                  "        console.log('‚úÖ Successful: ' + (stats.successCount || 0));",
                  "        console.log('‚ùå Failed: ' + (stats.failureCount || 0));",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit/stats?startDate=2024-01-01&endDate=2024-12-31",
              "host": ["{{baseUrl}}"],
              "path": ["audit", "stats"],
              "query": [
                { "key": "startDate", "value": "2024-01-01" },
                { "key": "endDate", "value": "2024-12-31" }
              ]
            },
            "description": "Get audit statistics including counts by action, resource, user, and status"
          }
        },
        {
          "name": "Export Audit Logs (CSV)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit/export/csv?startDate=2024-01-01&endDate=2024-12-31",
              "host": ["{{baseUrl}}"],
              "path": ["audit", "export", "csv"],
              "query": [
                { "key": "startDate", "value": "2024-01-01" },
                { "key": "endDate", "value": "2024-12-31" },
                { "key": "action", "value": "", "disabled": true },
                { "key": "resource", "value": "", "disabled": true }
              ]
            },
            "description": "Export audit logs to CSV format for compliance reporting. Filter by date range, action, and resource type."
          }
        },
        {
          "name": "Export Audit Logs (JSON)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit/export/json?startDate=2024-01-01&endDate=2024-12-31",
              "host": ["{{baseUrl}}"],
              "path": ["audit", "export", "json"],
              "query": [
                { "key": "startDate", "value": "2024-01-01" },
                { "key": "endDate", "value": "2024-12-31" }
              ]
            },
            "description": "Export audit logs to JSON format for data analysis and backup"
          }
        },
        {
          "name": "Get Archive Count",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/audit/archive/count?olderThanDays=90",
              "host": ["{{baseUrl}}"],
              "path": ["audit", "archive", "count"],
              "query": [{ "key": "olderThanDays", "value": "90" }]
            },
            "description": "Get count of logs that can be archived (older than specified days). Useful before running archive operation."
          }
        }
      ]
    },
    {
      "name": "üîÑ Loan Workflow Engine",
      "description": "Category-aware loan workflow management with assessments, visits, pledges, and disbursements",
      "item": [
        {
          "name": "Get Workflow Status",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data) {",
                  "        console.log('üìä Current Status: ' + response.data.currentStatus);",
                  "        console.log('‚úÖ Can Advance: ' + response.data.canAdvance);",
                  "        console.log('üìã Missing: ' + (response.data.missingRequirements?.join(', ') || 'None'));",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/loans/{{loanId}}/workflow-status",
              "host": ["{{baseUrl}}"],
              "path": [
                "loan-workflow",
                "loans",
                "{{loanId}}",
                "workflow-status"
              ]
            },
            "description": "Get complete workflow status including category requirements, completed steps, and next allowed transitions"
          }
        },
        {
          "name": "Submit for Assessment",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 201', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.assessment) {",
                  "        pm.collectionVariables.set('assessmentId', response.data.assessment.id);",
                  "        console.log('‚úÖ Assessment created: ' + response.data.assessment.id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"assessorId\": \"{{targetUserId}}\",\n  \"notes\": \"Initial assessment request\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/loans/{{loanId}}/submit-assessment",
              "host": ["{{baseUrl}}"],
              "path": [
                "loan-workflow",
                "loans",
                "{{loanId}}",
                "submit-assessment"
              ]
            },
            "description": "Submit a loan for assessment, creating an assessment record and transitioning to PENDING_ASSESSMENT"
          }
        },
        {
          "name": "Complete Assessment",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"status\": \"APPROVED\",\n  \"notes\": \"Assessment completed successfully. All documents verified.\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/assessments/{{assessmentId}}/complete",
              "host": ["{{baseUrl}}"],
              "path": [
                "loan-workflow",
                "assessments",
                "{{assessmentId}}",
                "complete"
              ]
            },
            "description": "Complete an assessment with APPROVED or REJECTED status. Automatically advances loan to next workflow stage based on category requirements."
          }
        },
        {
          "name": "Create Visit",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.visit) {",
                  "        pm.collectionVariables.set('visitId', response.data.visit.id);",
                  "        console.log('‚úÖ Visit created: ' + response.data.visit.id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"loanId\": \"{{loanId}}\",\n  \"visitType\": \"BUSINESS\",\n  \"address\": \"123 Business Street, City\",\n  \"notes\": \"Scheduled business verification visit\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/visits",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "visits"]
            },
            "description": "Schedule a new visit for loan verification. Visit types: BUSINESS, HOME"
          }
        },
        {
          "name": "Complete Visit",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"address\": \"123 Business Street, City\",\n  \"gpsLat\": -17.8292,\n  \"gpsLng\": 31.0522,\n  \"images\": [\"https://storage.example.com/visit-photos/img1.jpg\"],\n  \"notes\": \"Business verified. Location confirmed.\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/visits/{{visitId}}/complete",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "visits", "{{visitId}}", "complete"]
            },
            "description": "Mark a visit as completed with GPS coordinates, photos, and notes. Automatically advances workflow if all required visits are done."
          }
        },
        {
          "name": "Create Security Pledge",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.pledge) {",
                  "        pm.collectionVariables.set('pledgeId', response.data.pledge.id);",
                  "        console.log('‚úÖ Pledge created: ' + response.data.pledge.id);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"loanId\": \"{{loanId}}\",\n  \"itemDescription\": \"Samsung 55-inch Smart TV\",\n  \"serialNumber\": \"SN-123456789\",\n  \"estimatedValue\": 500,\n  \"currency\": \"USD\",\n  \"images\": [\"https://storage.example.com/pledge-photos/tv.jpg\"]\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/pledges",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "pledges"]
            },
            "description": "Register a security pledge for a loan. Required for loans where category.requiresSecurityPledge is true."
          }
        },
        {
          "name": "Verify Pledge and Check Status",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/pledges/{{pledgeId}}/verify-and-check",
              "host": ["{{baseUrl}}"],
              "path": [
                "loan-workflow",
                "pledges",
                "{{pledgeId}}",
                "verify-and-check"
              ]
            },
            "description": "Verify a security pledge and check if the loan can now advance in the workflow"
          }
        },
        {
          "name": "Approve Loan",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"notes\": \"All requirements met. Loan approved for disbursement.\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/loans/{{loanId}}/approve",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "loans", "{{loanId}}", "approve"]
            },
            "description": "Approve a loan with category-aware validation. Will fail if required steps (assessment, visits, pledges) are not completed."
          }
        },
        {
          "name": "Reject Loan",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reason\": \"Insufficient income documentation provided\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/loans/{{loanId}}/reject",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "loans", "{{loanId}}", "reject"]
            },
            "description": "Reject a loan application with a reason"
          }
        },
        {
          "name": "Mark for Disbursement",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"notes\": \"Ready for disbursement\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/loans/{{loanId}}/mark-for-disbursement",
              "host": ["{{baseUrl}}"],
              "path": [
                "loan-workflow",
                "loans",
                "{{loanId}}",
                "mark-for-disbursement"
              ]
            },
            "description": "Mark an approved loan as ready for disbursement"
          }
        },
        {
          "name": "Get Pending Disbursements",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data) {",
                  "        console.log('üìã Pending: ' + response.data.count + ' loans');",
                  "        console.log('üí∞ Total: ' + response.data.totalAmount);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/disbursements/pending?branchId={{branchId}}",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "disbursements", "pending"],
              "query": [
                { "key": "branchId", "value": "{{branchId}}", "disabled": true }
              ]
            },
            "description": "Get all loans pending disbursement. Optionally filter by branch."
          }
        },
        {
          "name": "Disburse Loan",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"disbursementMethod\": \"BANK_TRANSFER\",\n  \"reference\": \"TRF-2024-001\",\n  \"notes\": \"Disbursed via bank transfer\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/loans/{{loanId}}/disburse",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "loans", "{{loanId}}", "disburse"]
            },
            "description": "Disburse a loan. Methods: CASH, BANK_TRANSFER, MOBILE_MONEY, CHECK"
          }
        },
        {
          "name": "Batch Disburse Loans",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"loanIds\": [\"loan-id-1\", \"loan-id-2\", \"loan-id-3\"],\n  \"disbursementMethod\": \"MOBILE_MONEY\",\n  \"notes\": \"Batch disbursement for approved loans\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/disbursements/batch",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "disbursements", "batch"]
            },
            "description": "Disburse multiple loans at once. Returns success and failure counts."
          }
        },
        {
          "name": "Get Loan Workflow History",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/loans/{{loanId}}/history",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "loans", "{{loanId}}", "history"]
            },
            "description": "Get complete workflow history for a loan showing all status transitions"
          }
        },
        {
          "name": "Get Next Statuses",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/loans/{{loanId}}/next-statuses",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "loans", "{{loanId}}", "next-statuses"]
            },
            "description": "Get valid next status transitions for a loan based on current status"
          }
        },
        {
          "name": "Get Pending Assessments",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/assessments/pending?mine=true",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "assessments", "pending"],
              "query": [{ "key": "mine", "value": "true", "disabled": true }]
            },
            "description": "Get pending assessments. Set mine=true to see only your assignments."
          }
        },
        {
          "name": "Get Pending Visits",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/loan-workflow/visits/pending?mine=true",
              "host": ["{{baseUrl}}"],
              "path": ["loan-workflow", "visits", "pending"],
              "query": [{ "key": "mine", "value": "true", "disabled": true }]
            },
            "description": "Get scheduled visits that haven't been completed yet"
          }
        }
      ]
    },
    {
      "name": "üåê Public API (No Auth)",
      "description": "Public endpoints for online applications - no authentication required",
      "item": [
        {
          "name": "Get Available Products",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.products) {",
                  "        console.log('üìã Products available: ' + response.data.products.length);",
                  "        if (response.data.products.length > 0) {",
                  "            pm.collectionVariables.set('productId', response.data.products[0].id);",
                  "        }",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "noauth" },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/public/products",
              "host": ["{{baseUrl}}"],
              "path": ["public", "products"]
            },
            "description": "Get list of available loan products for online applications (no auth required)"
          }
        },
        {
          "name": "Get Product Details",
          "request": {
            "auth": { "type": "noauth" },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/public/products/{{productId}}",
              "host": ["{{baseUrl}}"],
              "path": ["public", "products", "{{productId}}"]
            },
            "description": "Get detailed information about a specific loan product including category requirements"
          }
        },
        {
          "name": "Apply - New Client",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.applicationId) {",
                  "        pm.collectionVariables.set('applicationId', response.data.applicationId);",
                  "        console.log('‚úÖ Application ID: ' + response.data.applicationId);",
                  "        if (response.data.verificationCode) {",
                  "            console.log('üîê Verification Code (dev only): ' + response.data.verificationCode);",
                  "        }",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"source\": \"WEB\",\n  \"clientPhone\": \"+263771234567\",\n  \"clientName\": \"John Doe\",\n  \"idNumber\": \"63-123456-A-78\",\n  \"amount\": 500,\n  \"productId\": \"{{productId}}\",\n  \"disbursementPreference\": \"TRANSFER\",\n  \"mobileNumber\": \"+263771234567\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/public/apply/new",
              "host": ["{{baseUrl}}"],
              "path": ["public", "apply", "new"]
            },
            "description": "Submit a new client loan application. Verification code will be sent via SMS (or shown in response in dev mode)."
          }
        },
        {
          "name": "Apply - Existing Client",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 201) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.applicationId) {",
                  "        pm.collectionVariables.set('applicationId', response.data.applicationId);",
                  "        console.log('‚úÖ Application ID: ' + response.data.applicationId);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"source\": \"WEB\",\n  \"clientPhone\": \"+263771234567\",\n  \"amount\": 1000,\n  \"productId\": \"{{productId}}\",\n  \"disbursementPreference\": \"CASH\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/public/apply/existing",
              "host": ["{{baseUrl}}"],
              "path": ["public", "apply", "existing"]
            },
            "description": "Submit an application for an existing client. Phone must match an existing client record."
          }
        },
        {
          "name": "Verify Application",
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"applicationId\": \"{{applicationId}}\",\n  \"code\": \"123456\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/public/verify",
              "host": ["{{baseUrl}}"],
              "path": ["public", "verify"]
            },
            "description": "Verify an application using the OTP code sent via SMS"
          }
        },
        {
          "name": "Check Application Status",
          "request": {
            "auth": { "type": "noauth" },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/public/application/{{applicationId}}/status",
              "host": ["{{baseUrl}}"],
              "path": ["public", "application", "{{applicationId}}", "status"]
            },
            "description": "Check the status of an online application"
          }
        },
        {
          "name": "Resend OTP",
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/public/application/{{applicationId}}/resend-otp",
              "host": ["{{baseUrl}}"],
              "path": [
                "public",
                "application",
                "{{applicationId}}",
                "resend-otp"
              ]
            },
            "description": "Resend the verification OTP code for a pending application"
          }
        },
        {
          "name": "Calculate Loan Repayments",
          "request": {
            "auth": { "type": "noauth" },
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"amount\": 1000,\n  \"term\": 12,\n  \"productId\": \"{{productId}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/public/calculate",
              "host": ["{{baseUrl}}"],
              "path": ["public", "calculate"]
            },
            "description": "Calculate loan repayments without authentication. Can use productId for rate or provide interestRate directly."
          }
        }
      ]
    },
    {
      "name": "üìù Online Applications (Admin)",
      "description": "Admin endpoints for managing online applications",
      "item": [
        {
          "name": "List Applications",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.data && response.data.length > 0) {",
                  "        pm.collectionVariables.set('applicationId', response.data[0].id);",
                  "        console.log('üìã Applications: ' + response.data.length);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/online-applications?page=1&limit=20",
              "host": ["{{baseUrl}}"],
              "path": ["online-applications"],
              "query": [
                { "key": "page", "value": "1" },
                { "key": "limit", "value": "20" },
                { "key": "status", "value": "PENDING", "disabled": true },
                { "key": "source", "value": "WEB", "disabled": true }
              ]
            },
            "description": "List all online applications with optional filtering by status, source, etc."
          }
        },
        {
          "name": "Get Application by ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/online-applications/{{applicationId}}",
              "host": ["{{baseUrl}}"],
              "path": ["online-applications", "{{applicationId}}"]
            },
            "description": "Get detailed information about a specific application"
          }
        },
        {
          "name": "Get Application Statistics",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/online-applications/stats",
              "host": ["{{baseUrl}}"],
              "path": ["online-applications", "stats"]
            },
            "description": "Get statistics on online applications including counts by source, status, and conversion rates"
          }
        },
        {
          "name": "Process Application (Approve/Reject)",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"action\": \"approve\",\n  \"notes\": \"Application verified and approved\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/online-applications/{{applicationId}}/process",
              "host": ["{{baseUrl}}"],
              "path": ["online-applications", "{{applicationId}}", "process"]
            },
            "description": "Approve or reject an online application. Actions: approve, reject"
          }
        },
        {
          "name": "Convert to Loan",
          "request": {
            "method": "POST",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"clientId\": \"{{clientId}}\",\n  \"loanOfficerId\": \"{{userId}}\",\n  \"branchId\": \"{{branchId}}\",\n  \"interestRate\": 15,\n  \"term\": 12,\n  \"repaymentFrequency\": \"MONTHLY\",\n  \"purpose\": \"Business expansion\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/online-applications/{{applicationId}}/convert-to-loan",
              "host": ["{{baseUrl}}"],
              "path": [
                "online-applications",
                "{{applicationId}}",
                "convert-to-loan"
              ]
            },
            "description": "Convert a verified/processed application into an actual loan"
          }
        },
        {
          "name": "Bulk Update Status",
          "request": {
            "method": "PUT",
            "header": [{ "key": "Content-Type", "value": "application/json" }],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"applicationIds\": [\"app-id-1\", \"app-id-2\"],\n  \"status\": \"PROCESSED\",\n  \"notes\": \"Bulk processed\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/online-applications/bulk-status",
              "host": ["{{baseUrl}}"],
              "path": ["online-applications", "bulk-status"]
            },
            "description": "Bulk update status for multiple applications"
          }
        },
        {
          "name": "Get Expired Applications",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/online-applications/expired",
              "host": ["{{baseUrl}}"],
              "path": ["online-applications", "expired"]
            },
            "description": "Get applications with expired verification codes"
          }
        },
        {
          "name": "Expire Pending Applications",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/online-applications/expire-pending",
              "host": ["{{baseUrl}}"],
              "path": ["online-applications", "expire-pending"]
            },
            "description": "Bulk expire all pending applications with expired verification codes"
          }
        }
      ]
    },
    {
      "name": "üîß System & Health",
      "description": "System health and information endpoints",
      "item": [
        {
          "name": "API Health Check",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('API is healthy', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.status).to.eql('OK');",
                  "});",
                  "",
                  "// Log system info",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    console.log('üè• API Status: ' + response.status);",
                  "    console.log('üåç Environment: ' + response.environment);",
                  "    console.log('‚è∞ Uptime: ' + Math.round(response.uptime) + 's');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}/health",
              "host": ["{{baseUrl}}"],
              "path": ["health"]
            },
            "description": "Check API health status - no authentication required"
          }
        },
        {
          "name": "API Information",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "pm.test('Status code is 200', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('API info retrieved', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('name');",
                  "    pm.expect(jsonData).to.have.property('version');",
                  "});",
                  "",
                  "// Log API info",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    console.log('üìã API: ' + response.name);",
                  "    console.log('üè∑Ô∏è Version: ' + response.version);",
                  "    if (response.endpoints) {",
                  "        console.log('üìö Available endpoints: ' + Object.keys(response.endpoints).length);",
                  "    }",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{baseUrl}}",
              "host": ["{{baseUrl}}"]
            },
            "description": "Get API information and available endpoints - no authentication required"
          }
        }
      ]
    }
  ]
}
