generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Organization {
  id                    String                 @id @default(uuid())
  name                  String                 @unique
  type                  OrganizationType       @default(MICROFINANCE)
  address               String?
  phone                 String?
  email                 String?
  website               String?
  registrationNumber    String?                @unique
  licenseNumber         String?                @unique
  isActive              Boolean                @default(true)
  apiTier               ApiTier                @default(BASIC)
  apiKeysCount          Int                    @default(0)
  maxApiKeys            Int                    @default(1)
  rateLimit             Int                    @default(100)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  logo                  String?
  apiKeys               ApiKey[]
  auditLogs             AuditLog[]
  branches              Branch[]
  charges               Charge[]
  clients               Client[]
  collateralTypes       CollateralType[]
  documentTypes         DocumentType[]
  exchangeRates         ExchangeRate[]
  expenseCategories     ExpenseCategory[]
  financialTransactions FinancialTransaction[]
  importJobs            ImportJob[]
  incomeCategories      IncomeCategory[]
  loanCategories        LoanCategory[]
  loanProducts          LoanProduct[]
  loanPurposes          LoanPurpose[]
  loans                 Loan[]
  organizationAIConfigs OrganizationAIConfig[]
  settings              OrganizationSettings[]
  paymentMethods        PaymentMethod[]
  roles                 Role[]
  shops                 Shop[]
  users                 User[]
  monthlyTargets        MonthlyTarget[]

  @@map("organizations")
}

model OrganizationSettings {
  id             String       @id @default(uuid())
  organizationId String
  settingKey     String
  settingValue   Json
  description    String?
  updatedBy      String?
  updatedAt      DateTime     @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, settingKey])
  @@map("organization_settings")
}

model SystemSettings {
  id           String   @id @default(uuid())
  settingKey   String   @unique
  settingValue Json
  description  String?
  updatedBy    String?
  updatedAt    DateTime @updatedAt

  @@map("system_settings")
}

model CurrencyRecord {
  id            String   @id @default(uuid())
  code          String   @unique
  name          String
  symbol        String
  position      String   @default("before")
  decimalPlaces Int      @default(2)
  isActive      Boolean  @default(true)
  isDefault     Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  createdBy     String?
  updatedBy     String?

  @@map("currencies")
}

model PaymentMethod {
  id                String                 @id @default(uuid())
  organizationId    String
  name              String
  code              String
  type              PaymentMethodType
  accountNumber     String?
  description       String?
  initialBalance    Decimal                @default(0) @db.Decimal(15, 2)
  currentBalance    Decimal                @default(0) @db.Decimal(15, 2)
  currency          String                 @default("USD")
  isActive          Boolean                @default(true)
  isDefault         Boolean                @default(false)
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt
  createdBy         String?
  updatedBy         String?
  allowDisbursement Boolean                @default(true)
  allowRepayment    Boolean                @default(true)
  transactions      FinancialTransaction[]
  organization      Organization           @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, code])
  @@map("payment_methods")
}

model IncomeCategory {
  id               String                 @id @default(uuid())
  organizationId   String
  name             String
  code             String
  description      String?
  isSystemCategory Boolean                @default(false)
  isActive         Boolean                @default(true)
  createdAt        DateTime               @default(now())
  updatedAt        DateTime               @updatedAt
  createdBy        String?
  transactions     FinancialTransaction[]
  organization     Organization           @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, code])
  @@map("income_categories")
}

model ExpenseCategory {
  id               String                 @id @default(uuid())
  organizationId   String
  name             String
  code             String
  description      String?
  isSystemCategory Boolean                @default(false)
  isActive         Boolean                @default(true)
  createdAt        DateTime               @default(now())
  updatedAt        DateTime               @updatedAt
  createdBy        String?
  organization     Organization           @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  transactions     FinancialTransaction[]

  @@unique([organizationId, code])
  @@map("expense_categories")
}

model FinancialTransaction {
  id                String                     @id @default(uuid())
  organizationId    String
  branchId          String?
  transactionNumber String                     @unique
  type              FinancialTransactionType
  incomeCategoryId  String?
  expenseCategoryId String?
  paymentMethodId   String
  amount            Decimal                    @db.Decimal(15, 2)
  currency          String                     @default("USD")
  description       String
  reference         String?
  relatedLoanId     String?
  relatedPaymentId  String?
  transactionDate   DateTime                   @default(now())
  balanceBefore     Decimal                    @db.Decimal(15, 2)
  balanceAfter      Decimal                    @db.Decimal(15, 2)
  status            FinancialTransactionStatus @default(COMPLETED)
  notes             String?
  attachments       Json?
  processedBy       String
  approvedBy        String?
  approvedAt        DateTime?
  voidedBy          String?
  voidedAt          DateTime?
  voidReason        String?
  createdAt         DateTime                   @default(now())
  updatedAt         DateTime                   @updatedAt
  approver          User?                      @relation("TransactionApprover", fields: [approvedBy], references: [id])
  branch            Branch?                    @relation(fields: [branchId], references: [id])
  expenseCategory   ExpenseCategory?           @relation(fields: [expenseCategoryId], references: [id])
  incomeCategory    IncomeCategory?            @relation(fields: [incomeCategoryId], references: [id])
  organization      Organization               @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  paymentMethod     PaymentMethod              @relation(fields: [paymentMethodId], references: [id])
  processor         User                       @relation("TransactionProcessor", fields: [processedBy], references: [id])
  relatedLoan       Loan?                      @relation(fields: [relatedLoanId], references: [id])
  voider            User?                      @relation("TransactionVoider", fields: [voidedBy], references: [id])

  @@index([organizationId, transactionDate])
  @@index([paymentMethodId])
  @@map("financial_transactions")
}

model ExchangeRate {
  id             String       @id @default(uuid())
  organizationId String
  fromCurrency   Currency
  toCurrency     Currency
  rate           Decimal      @db.Decimal(10, 6)
  effectiveDate  DateTime     @default(now())
  createdBy      String?
  createdAt      DateTime     @default(now())
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@map("exchange_rates")
}

model Branch {
  id                    String                 @id @default(uuid())
  organizationId        String
  name                  String
  code                  String                 @unique
  address               String?
  phone                 String?
  email                 String?
  managerId             String?                @unique
  isActive              Boolean                @default(true)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  manager               User?                  @relation("BranchManager", fields: [managerId], references: [id])
  organization          Organization           @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  clients               Client[]
  homeClients           Client[]               @relation("ClientHomeBranch")
  financialTransactions FinancialTransaction[]
  loans                 Loan[]
  disbursedLoans        Loan[]                 @relation("LoanDisbursementBranch")
  processedPayments     Payment[]              @relation("PaymentProcessedBranch")
  userBranches          UserBranch[]
  users                 User[]                 @relation("BranchUsers")
  monthlyTargets        MonthlyTarget[]

  @@map("branches")
}

model UserBranch {
  id         String   @id @default(uuid())
  userId     String
  branchId   String
  isCurrent  Boolean  @default(false)
  isPrimary  Boolean  @default(false)
  assignedAt DateTime @default(now())
  assignedBy String?
  branch     Branch   @relation(fields: [branchId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, branchId])
  @@index([userId])
  @@index([branchId])
  @@map("user_branches")
}

model User {
  id                    String                 @id @default(uuid())
  email                 String                 @unique
  password              String
  firstName             String
  lastName              String
  phone                 String?
  dateOfBirth           DateTime?
  avatar                String?
  role                  UserRole               @default(STAFF)
  isActive              Boolean                @default(true)
  isEmailVerified       Boolean                @default(false)
  lastLoginAt           DateTime?
  organizationId        String?
  branchId              String?
  permissions           String[]               @default([])
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  auditLogs             AuditLog[]
  managedBranch         Branch?                @relation("BranchManager")
  createdClients        Client[]               @relation("ClientCreatedBy")
  approvedTransactions  FinancialTransaction[] @relation("TransactionApprover")
  processedTransactions FinancialTransaction[] @relation("TransactionProcessor")
  voidedTransactions    FinancialTransaction[] @relation("TransactionVoider")
  assessments           LoanAssessment[]
  visits                LoanVisit[]
  workflowChanges       LoanWorkflowHistory[]
  createdLoans          Loan[]                 @relation("LoanOfficer")
  notes                 Note[]
  payments              Payment[]
  refreshTokens         RefreshToken[]
  userBranches          UserBranch[]
  userPermissions       UserPermission[]
  userRoles             UserRoleAssignment[]
  sessions              UserSession[]
  branch                Branch?                @relation("BranchUsers", fields: [branchId], references: [id])
  organization          Organization?          @relation(fields: [organizationId], references: [id])

  @@map("users")
}

model RefreshToken {
  id        String   @id @default(uuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("refresh_tokens")
}

model UserSession {
  id             String   @id @default(uuid())
  userId         String
  token          String   @unique
  deviceInfo     Json?
  ipAddress      String?
  userAgent      String?
  isActive       Boolean  @default(true)
  lastActivityAt DateTime @default(now())
  expiresAt      DateTime
  createdAt      DateTime @default(now())
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@index([isActive])
  @@map("user_sessions")
}

model Client {
  id               String             @id @default(uuid())
  clientNumber     String             @unique
  type             ClientType         @default(INDIVIDUAL)
  firstName        String?
  lastName         String?
  businessName     String?
  email            String?
  phone            String             @unique
  dateOfBirth      DateTime?
  gender           String?
  maritalStatus    String?
  idNumber         String?            @unique
  address          String?
  city             String?
  state            String?
  zipCode          String?
  country          String?
  employmentStatus String?
  monthlyIncome    Decimal?           @db.Decimal(15, 2)
  creditScore      Int?
  isActive         Boolean            @default(true)
  kycStatus        String             @default("PENDING")
  kycDocuments     Json?
  profileImage     String?
  thumbprintImage  String?
  signatureImage   String?
  organizationId   String
  branchId         String
  homeBranchId     String?
  createdBy        String
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  idExpiryDate     DateTime?
  idIssueDate      DateTime?
  idType           String?            @default("national_id")
  issuingAuthority String?
  nationality      String?            @default("Zimbabwean")
  passportCountry  String?
  passportNumber   String?
  placeOfBirth     String?
  title            String?
  addresses        ClientAddress[]
  business         ClientBusiness?
  collaterals      ClientCollateral[]
  contacts         ClientContact[]
  documents        ClientDocument[]
  employers        ClientEmployer[]
  clientLimits     ClientLimit[]
  branch           Branch             @relation(fields: [branchId], references: [id])
  creator          User               @relation("ClientCreatedBy", fields: [createdBy], references: [id])
  homeBranch       Branch?            @relation("ClientHomeBranch", fields: [homeBranchId], references: [id])
  organization     Organization       @relation(fields: [organizationId], references: [id])
  groupMemberships GroupMember[]
  loans            Loan[]
  nextOfKins       NextOfKin[]

  @@map("clients")
}

model Group {
  id             String        @id @default(uuid())
  name           String
  description    String?
  groupNumber    String        @unique
  meetingDay     String?
  meetingTime    String?
  meetingPlace   String?
  isActive       Boolean       @default(true)
  organizationId String
  branchId       String
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  members        GroupMember[]
  loans          Loan[]

  @@map("groups")
}

model GroupMember {
  id       String    @id @default(uuid())
  groupId  String
  clientId String
  role     String    @default("MEMBER")
  joinedAt DateTime  @default(now())
  leftAt   DateTime?
  isActive Boolean   @default(true)
  client   Client    @relation(fields: [clientId], references: [id])
  group    Group     @relation(fields: [groupId], references: [id], onDelete: Cascade)

  @@unique([groupId, clientId])
  @@map("group_members")
}

model LoanPurpose {
  id             String       @id @default(uuid())
  organizationId String
  name           String
  code           String
  description    String?
  loanClass      LoanClass    @default(CONSUMER)
  isActive       Boolean      @default(true)
  sortOrder      Int          @default(0)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, code])
  @@map("loan_purposes")
}

model LoanProduct {
  id                    String                    @id @default(uuid())
  name                  String
  description           String?
  type                  LoanType                  @default(PERSONAL)
  minAmount             Decimal                   @db.Decimal(15, 2)
  maxAmount             Decimal                   @db.Decimal(15, 2)
  currency              Currency                  @default(USD)
  interestRate          Decimal                   @db.Decimal(5, 4)
  interestRateFrequency RepaymentFrequency        @default(ANNUAL)
  calculationMethod     LoanCalculationMethod     @default(REDUCING_BALANCE)
  minTerm               Int
  maxTerm               Int
  repaymentFrequency    RepaymentFrequency        @default(MONTHLY)
  gracePeriod           Int
  penaltyRate           Decimal                   @default(0) @db.Decimal(5, 4)
  isActive              Boolean                   @default(true)
  requiresCollateral    Boolean                   @default(false)
  requiresGuarantor     Boolean                   @default(false)
  categoryId            String?
  isOnlineEligible      Boolean                   @default(false)
  organizationId        String
  createdAt             DateTime                  @default(now())
  updatedAt             DateTime                  @updatedAt
  gracePeriodDays       Int                       @default(0)
  durationUnit          DurationUnit              @default(MONTHS)
  minPeriod             Int                       @default(1)
  maxPeriod             Int                       @default(12)
  engineType            LoanCalculationEngineType @default(SHORT_TERM)
  allowAutoCalculations Boolean                   @default(true)
  category              LoanCategory?             @relation(fields: [categoryId], references: [id])
  organization          Organization              @relation(fields: [organizationId], references: [id])
  loans                 Loan[]
  productCharges        ProductCharge[]

  @@map("loan_products")
}

model Loan {
  id                    String                 @id @default(uuid())
  loanNumber            String                 @unique
  clientId              String
  groupId               String?
  productId             String
  organizationId        String
  branchId              String
  loanOfficerId         String
  amount                Decimal                @db.Decimal(15, 2)
  currency              Currency               @default(USD)
  interestRate          Decimal                @db.Decimal(5, 4)
  calculationMethod     LoanCalculationMethod  @default(REDUCING_BALANCE)
  term                  Int
  repaymentFrequency    RepaymentFrequency
  installmentAmount     Decimal                @db.Decimal(15, 2)
  totalAmount           Decimal                @db.Decimal(15, 2)
  totalInterest         Decimal                @db.Decimal(15, 2)
  status                LoanStatus             @default(PENDING)
  applicationDate       DateTime               @default(now())
  approvedDate          DateTime?
  disbursedDate         DateTime?
  maturityDate          DateTime?
  lastPaymentDate       DateTime?
  outstandingBalance    Decimal                @default(0) @db.Decimal(15, 2)
  principalBalance      Decimal                @default(0) @db.Decimal(15, 2)
  interestBalance       Decimal                @default(0) @db.Decimal(15, 2)
  penaltyBalance        Decimal                @default(0) @db.Decimal(15, 2)
  purpose               String?
  collateralValue       Decimal?               @db.Decimal(15, 2)
  collateralDescription String?
  guarantorInfo         Json?
  notes                 String?
  shopId                String?
  applicationSource     ApplicationSource      @default(BRANCH)
  onlineApplicationId   String?
  disbursementBranchId  String?
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  syncStatus            SyncStatus             @default(SYNCED)
  syncVersion           Int                    @default(1)
  startDate             DateTime?
  expectedRepaymentDate DateTime?
  nextDueDate           DateTime?
  interestAmount        Decimal                @default(0) @db.Decimal(15, 2)
  gracePeriodDays       Int                    @default(0)
  collaterals           ClientCollateral[]
  financialTransactions FinancialTransaction[]
  assessments           LoanAssessment[]
  loanCharges           LoanCharge[]
  loanItems             LoanItem[]
  visits                LoanVisit[]
  workflowHistory       LoanWorkflowHistory[]
  branch                Branch                 @relation(fields: [branchId], references: [id])
  client                Client                 @relation(fields: [clientId], references: [id])
  disbursementBranch    Branch?                @relation("LoanDisbursementBranch", fields: [disbursementBranchId], references: [id])
  group                 Group?                 @relation(fields: [groupId], references: [id])
  loanOfficer           User                   @relation("LoanOfficer", fields: [loanOfficerId], references: [id])
  onlineApplication     OnlineApplication?     @relation(fields: [onlineApplicationId], references: [id])
  organization          Organization           @relation(fields: [organizationId], references: [id])
  product               LoanProduct            @relation(fields: [productId], references: [id])
  shop                  Shop?                  @relation(fields: [shopId], references: [id])
  payments              Payment[]
  repaymentSchedule     RepaymentSchedule[]
  pledges               SecurityPledge[]

  @@map("loans")
}

model RepaymentSchedule {
  id                String        @id @default(uuid())
  loanId            String
  installmentNumber Int
  dueDate           DateTime
  principalAmount   Decimal       @db.Decimal(15, 2)
  interestAmount    Decimal       @db.Decimal(15, 2)
  totalAmount       Decimal       @db.Decimal(15, 2)
  paidAmount        Decimal       @default(0) @db.Decimal(15, 2)
  outstandingAmount Decimal       @db.Decimal(15, 2)
  status            PaymentStatus @default(PENDING)
  paymentDate       DateTime?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt
  loan              Loan          @relation(fields: [loanId], references: [id], onDelete: Cascade)

  @@unique([loanId, installmentNumber])
  @@map("repayment_schedule")
}

model Payment {
  id                String          @id @default(uuid())
  paymentNumber     String          @unique
  loanId            String
  amount            Decimal         @db.Decimal(15, 2)
  currency          Currency        @default(USD)
  principalAmount   Decimal         @default(0) @db.Decimal(15, 2)
  interestAmount    Decimal         @default(0) @db.Decimal(15, 2)
  penaltyAmount     Decimal         @default(0) @db.Decimal(15, 2)
  type              TransactionType @default(LOAN_REPAYMENT)
  method            String
  status            PaymentStatus   @default(PENDING)
  transactionRef    String?
  gatewayResponse   Json?
  paymentDate       DateTime        @default(now())
  receivedBy        String
  notes             String?
  processedBranchId String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt
  loan              Loan            @relation(fields: [loanId], references: [id])
  processedBranch   Branch?         @relation("PaymentProcessedBranch", fields: [processedBranchId], references: [id])
  receiver          User            @relation(fields: [receivedBy], references: [id])

  @@map("payments")
}

model Charge {
  id                      String                @id @default(uuid())
  name                    String
  type                    ChargeType
  defaultAmount           Decimal?              @db.Decimal(15, 2)
  description             String?
  isActive                Boolean               @default(true)
  organizationId          String
  createdAt               DateTime              @default(now())
  updatedAt               DateTime              @updatedAt
  calculationType         ChargeCalculationType @default(FIXED)
  appliesAt               ChargeAppliesAt       @default(DISBURSEMENT)
  defaultPercentage       Decimal?              @db.Decimal(10, 4)
  isMandatory             Boolean               @default(false)
  code                    String
  isDeductedFromPrincipal Boolean               @default(false)
  createdBy               String?
  updatedBy               String?
  triggerStatus           LoanStatus?
  chargeMode              ChargeMode            @default(MANUAL)
  chargeApplication       ChargeApplication     @default(PRINCIPAL)
  chargeRates             ChargeRate[]
  organization            Organization          @relation(fields: [organizationId], references: [id])
  loanCharges             LoanCharge[]
  productCharges          ProductCharge[]

  @@unique([organizationId, code])
  @@map("charges")
}

model ChargeRate {
  id         String   @id @default(uuid())
  chargeId   String
  amount     Decimal? @db.Decimal(15, 2)
  percentage Decimal? @db.Decimal(5, 4)
  minAmount  Decimal? @db.Decimal(15, 2)
  maxAmount  Decimal? @db.Decimal(15, 2)
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  currency   Currency
  charge     Charge   @relation(fields: [chargeId], references: [id], onDelete: Cascade)

  @@unique([chargeId, currency])
  @@map("charge_rates")
}

model ProductCharge {
  id               String      @id @default(uuid())
  productId        String
  chargeId         String
  isActive         Boolean     @default(true)
  createdAt        DateTime    @default(now())
  isMandatory      Boolean     @default(false)
  customAmount     Decimal?    @db.Decimal(15, 2)
  customPercentage Decimal?    @db.Decimal(5, 4)
  updatedAt        DateTime    @updatedAt
  charge           Charge      @relation(fields: [chargeId], references: [id])
  product          LoanProduct @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, chargeId])
  @@map("product_charges")
}

model LoanCharge {
  id                      String                @id @default(uuid())
  loanId                  String
  chargeId                String
  amount                  Decimal               @db.Decimal(15, 2)
  paidAmount              Decimal               @default(0) @db.Decimal(15, 2)
  status                  PaymentStatus         @default(PENDING)
  appliedAt               DateTime              @default(now())
  paidAt                  DateTime?
  financialTransactionId  String?
  calculationType         ChargeCalculationType
  baseAmount              Decimal               @db.Decimal(15, 2)
  chargeName              String
  chargeType              ChargeType
  calculatedAmount        Decimal               @db.Decimal(15, 2)
  isDeductedFromPrincipal Boolean               @default(false)
  isWaived                Boolean               @default(false)
  waivedBy                String?
  waivedAt                DateTime?
  waiverReason            String?
  appliedBy               String?
  currency                Currency
  charge                  Charge                @relation(fields: [chargeId], references: [id])
  loan                    Loan                  @relation(fields: [loanId], references: [id], onDelete: Cascade)

  @@map("loan_charges")
}

model Employer {
  id              String           @id @default(uuid())
  name            String
  address         String?
  phone           String?
  email           String?
  contactPerson   String?
  isActive        Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  clientEmployers ClientEmployer[]

  @@map("employers")
}

model ClientEmployer {
  id         String    @id @default(uuid())
  clientId   String
  employerId String
  position   String?
  salary     Decimal?  @db.Decimal(15, 2)
  startDate  DateTime?
  endDate    DateTime?
  isActive   Boolean   @default(true)
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  client     Client    @relation(fields: [clientId], references: [id], onDelete: Cascade)
  employer   Employer  @relation(fields: [employerId], references: [id])

  @@unique([clientId, employerId])
  @@map("client_employers")
}

model NextOfKin {
  id           String   @id @default(uuid())
  clientId     String
  name         String
  relationship String
  phone        String
  email        String?
  address      String?
  isPrimary    Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  client       Client   @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@map("next_of_kins")
}

model ClientLimit {
  id         String    @id @default(uuid())
  clientId   String
  maxAmount  Decimal   @db.Decimal(15, 2)
  currency   Currency  @default(USD)
  usedAmount Decimal   @default(0) @db.Decimal(15, 2)
  isActive   Boolean   @default(true)
  validFrom  DateTime  @default(now())
  validTo    DateTime?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  client     Client    @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@map("client_limits")
}

model DocumentType {
  id             String           @id @default(uuid())
  organizationId String
  name           String
  code           String
  description    String?
  isRequired     Boolean          @default(false)
  isActive       Boolean          @default(true)
  sortOrder      Int              @default(0)
  validityDays   Int?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  documents      ClientDocument[]
  organization   Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, code])
  @@map("document_types")
}

model AIProvider {
  id                  String                 @id @default(uuid())
  name                String                 @unique
  displayName         String
  baseUrl             String?
  isActive            Boolean                @default(true)
  isLocal             Boolean                @default(false)
  capabilities        String[]               @default([])
  createdAt           DateTime               @default(now())
  updatedAt           DateTime               @updatedAt
  organizationConfigs OrganizationAIConfig[]

  @@map("ai_providers")
}

model OrganizationAIConfig {
  id             String       @id @default(uuid())
  organizationId String
  aiProviderId   String
  apiKey         String?
  modelName      String?
  isEnabled      Boolean      @default(true)
  isPrimary      Boolean      @default(false)
  maxTokens      Int?
  temperature    Float?
  settings       Json?
  usageThisMonth Int          @default(0)
  usageLimit     Int?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  aiProvider     AIProvider   @relation(fields: [aiProviderId], references: [id])
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, aiProviderId])
  @@map("organization_ai_configs")
}

model ClientAddress {
  id           String      @id @default(uuid())
  clientId     String
  addressType  AddressType @default(RESIDENTIAL)
  addressLine1 String
  addressLine2 String?
  suburb       String?
  city         String
  state        String?
  zipCode      String?
  country      String      @default("Zimbabwe")
  latitude     Float?
  longitude    Float?
  isPrimary    Boolean     @default(false)
  isVerified   Boolean     @default(false)
  verifiedAt   DateTime?
  notes        String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  client       Client      @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@map("client_addresses")
}

model ClientContact {
  id           String      @id @default(uuid())
  clientId     String
  contactType  ContactType @default(MOBILE)
  contactValue String
  label        String?
  isPrimary    Boolean     @default(false)
  isWhatsApp   Boolean     @default(false)
  isVerified   Boolean     @default(false)
  verifiedAt   DateTime?
  notes        String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  client       Client      @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@map("client_contacts")
}

model ClientDocument {
  id               String         @id @default(uuid())
  clientId         String
  documentTypeId   String
  fileName         String
  fileSize         Int
  mimeType         String
  storagePath      String
  storageUrl       String?
  documentNumber   String?
  issueDate        DateTime?
  expiryDate       DateTime?
  issuingAuthority String?
  status           DocumentStatus @default(PENDING)
  rejectionReason  String?
  aiExtractionData Json?
  aiConfidence     Float?
  extractedAt      DateTime?
  verifiedBy       String?
  verifiedAt       DateTime?
  notes            String?
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  client           Client         @relation(fields: [clientId], references: [id], onDelete: Cascade)
  documentType     DocumentType   @relation(fields: [documentTypeId], references: [id])

  @@map("client_documents")
}

model ClientBusiness {
  id                 String       @id @default(uuid())
  clientId           String       @unique
  businessName       String
  tradingName        String?
  registrationNumber String?
  taxNumber          String?
  vatNumber          String?
  businessType       BusinessType @default(SOLE_PROPRIETOR)
  industry           String?
  sector             String?
  yearEstablished    Int?
  numberOfEmployees  Int?
  monthlyTurnover    Decimal?     @db.Decimal(15, 2)
  annualRevenue      Decimal?     @db.Decimal(15, 2)
  businessAddress    String?
  businessPhone      String?
  businessEmail      String?
  website            String?
  bankName           String?
  bankAccountNumber  String?
  bankBranchCode     String?
  notes              String?
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
  client             Client       @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@map("client_businesses")
}

model CollateralType {
  id             String             @id @default(uuid())
  organizationId String
  name           String
  code           String
  description    String?
  isActive       Boolean            @default(true)
  sortOrder      Int                @default(0)
  requiredFields String[]           @default([])
  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt
  collaterals    ClientCollateral[]
  organization   Organization       @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@unique([organizationId, code])
  @@map("collateral_types")
}

model ClientCollateral {
  id                  String               @id @default(uuid())
  clientId            String
  collateralTypeId    String
  description         String
  estimatedValue      Decimal              @db.Decimal(15, 2)
  currency            Currency             @default(USD)
  valuationDate       DateTime?
  valuator            String?
  registrationNumber  String?
  serialNumber        String?
  make                String?
  model               String?
  year                Int?
  location            String?
  ownershipStatus     OwnershipStatus      @default(FULLY_OWNED)
  ownershipDetails    String?
  insuranceProvider   String?
  insurancePolicyNo   String?
  insuranceExpiryDate DateTime?
  status              CollateralStatus     @default(AVAILABLE)
  loanId              String?
  pledgedAt           DateTime?
  releasedAt          DateTime?
  notes               String?
  metadata            Json?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  client              Client               @relation(fields: [clientId], references: [id], onDelete: Cascade)
  collateralType      CollateralType       @relation(fields: [collateralTypeId], references: [id])
  loan                Loan?                @relation(fields: [loanId], references: [id])
  documents           CollateralDocument[]

  @@map("client_collaterals")
}

model CollateralDocument {
  id           String           @id @default(uuid())
  collateralId String
  fileName     String
  fileSize     Int
  mimeType     String
  storagePath  String
  documentType String
  notes        String?
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
  collateral   ClientCollateral @relation(fields: [collateralId], references: [id], onDelete: Cascade)

  @@map("collateral_documents")
}

model ImportJob {
  id               String       @id @default(uuid())
  organizationId   String
  importType       ImportType
  fileName         String
  originalFileName String
  storagePath      String
  status           ImportStatus @default(PENDING)
  totalRows        Int?
  processedRows    Int          @default(0)
  successfulRows   Int          @default(0)
  failedRows       Int          @default(0)
  errorLog         Json?
  mapping          Json?
  createdBy        String
  startedAt        DateTime?
  completedAt      DateTime?
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  organization     Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@map("import_jobs")
}

model ApiKey {
  id             String       @id @default(uuid())
  name           String
  key            String       @unique
  organizationId String
  isActive       Boolean      @default(true)
  permissions    String[]     @default([])
  rateLimit      Int?
  lastUsed       DateTime?
  expiresAt      DateTime?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@map("api_keys")
}

model AuditLog {
  id             String        @id @default(uuid())
  userId         String?
  organizationId String?
  action         String
  resource       String
  resourceId     String?
  changes        Json?
  ipAddress      String?
  userAgent      String?
  timestamp      DateTime      @default(now())
  branchId       String?
  duration       Int?
  errorMessage   String?
  newValue       Json?
  previousValue  Json?
  requestId      String?
  sessionId      String?
  status         AuditStatus   @default(SUCCESS)
  organization   Organization? @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user           User?         @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([organizationId])
  @@index([resource])
  @@index([action])
  @@index([timestamp])
  @@index([requestId])
  @@index([resourceId])
  @@map("audit_logs")
}

model Permission {
  id              String           @id @default(uuid())
  code            String           @unique
  name            String
  description     String?
  module          String
  isActive        Boolean          @default(true)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  rolePermissions RolePermission[]

  @@index([module])
  @@index([code])
  @@map("permissions")
}

model Role {
  id              String               @id @default(uuid())
  name            String
  description     String?
  organizationId  String?
  isSystem        Boolean              @default(false)
  isDefault       Boolean              @default(false)
  isActive        Boolean              @default(true)
  createdAt       DateTime             @default(now())
  updatedAt       DateTime             @updatedAt
  rolePermissions RolePermission[]
  organization    Organization?        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  userRoles       UserRoleAssignment[]

  @@unique([name, organizationId])
  @@index([organizationId])
  @@map("roles")
}

model RolePermission {
  id           String     @id @default(uuid())
  roleId       String
  permissionId String
  createdAt    DateTime   @default(now())
  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  role         Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@unique([roleId, permissionId])
  @@map("role_permissions")
}

model UserRoleAssignment {
  id         String    @id @default(uuid())
  userId     String
  roleId     String
  assignedBy String?
  assignedAt DateTime  @default(now())
  expiresAt  DateTime?
  isActive   Boolean   @default(true)
  role       Role      @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, roleId])
  @@index([userId])
  @@index([roleId])
  @@map("user_role_assignments")
}

model UserPermission {
  id             String    @id @default(uuid())
  userId         String
  permissionCode String
  grantedBy      String?
  grantedAt      DateTime  @default(now())
  expiresAt      DateTime?
  isActive       Boolean   @default(true)
  user           User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, permissionCode])
  @@index([userId])
  @@map("user_permissions")
}

model LoanCategory {
  id                     String        @id @default(uuid())
  name                   String
  code                   String
  description            String?
  isLongTerm             Boolean       @default(false)
  requiresBusinessVisit  Boolean       @default(false)
  requiresHomeVisit      Boolean       @default(false)
  requiresSecurityPledge Boolean       @default(false)
  requiresCollateral     Boolean       @default(false)
  organizationId         String
  isActive               Boolean       @default(true)
  createdAt              DateTime      @default(now())
  updatedAt              DateTime      @updatedAt
  organization           Organization  @relation(fields: [organizationId], references: [id])
  products               LoanProduct[]

  @@unique([organizationId, code])
  @@map("loan_categories")
}

model LoanAssessment {
  id                String    @id @default(uuid())
  loanId            String
  assessorId        String
  status            String
  documentChecklist Json?
  notes             String?
  completedAt       DateTime?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  clientCharacter   String?
  clientCapacity    String?
  collateralQuality String?
  conditions        String?
  capitalAdequacy   String?
  recommendedAmount Decimal?  @db.Decimal(15, 2)
  recommendation    String?
  assessor          User      @relation(fields: [assessorId], references: [id])
  loan              Loan      @relation(fields: [loanId], references: [id], onDelete: Cascade)

  @@map("loan_assessments")
}

model LoanVisit {
  id        String    @id @default(uuid())
  loanId    String
  visitType VisitType
  address   String?
  gpsLat    Decimal?  @db.Decimal(10, 8)
  gpsLng    Decimal?  @db.Decimal(11, 8)
  visitedBy String
  visitedAt DateTime?
  images    String[]
  notes     String?
  syncedAt  DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  loan      Loan      @relation(fields: [loanId], references: [id], onDelete: Cascade)
  visitor   User      @relation(fields: [visitedBy], references: [id])

  @@map("loan_visits")
}

model SecurityPledge {
  id              String   @id @default(uuid())
  loanId          String
  itemDescription String
  serialNumber    String?
  estimatedValue  Decimal  @db.Decimal(15, 2)
  currency        Currency @default(USD)
  images          String[]
  status          String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  loan            Loan     @relation(fields: [loanId], references: [id], onDelete: Cascade)

  @@map("security_pledges")
}

model LoanWorkflowHistory {
  id         String     @id @default(uuid())
  loanId     String
  fromStatus LoanStatus
  toStatus   LoanStatus
  changedBy  String
  changedAt  DateTime   @default(now())
  notes      String?
  changer    User       @relation(fields: [changedBy], references: [id])
  loan       Loan       @relation(fields: [loanId], references: [id], onDelete: Cascade)

  @@map("loan_workflow_history")
}

model Shop {
  id             String        @id @default(uuid())
  name           String
  address        String?
  phone          String?
  contactPerson  String?
  bankAccount    String?
  mobileNumber   String?
  organizationId String
  isActive       Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  loans          Loan[]
  products       ShopProduct[]
  organization   Organization  @relation(fields: [organizationId], references: [id])

  @@map("shops")
}

model ShopProduct {
  id          String     @id @default(uuid())
  shopId      String
  name        String
  description String?
  price       Decimal    @db.Decimal(15, 2)
  currency    Currency   @default(USD)
  sku         String?
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  loanItems   LoanItem[]
  shop        Shop       @relation(fields: [shopId], references: [id], onDelete: Cascade)

  @@map("shop_products")
}

model LoanItem {
  id            String      @id @default(uuid())
  loanId        String
  shopProductId String
  quantity      Int
  unitPrice     Decimal     @db.Decimal(15, 2)
  totalPrice    Decimal     @db.Decimal(15, 2)
  createdAt     DateTime    @default(now())
  loan          Loan        @relation(fields: [loanId], references: [id], onDelete: Cascade)
  shopProduct   ShopProduct @relation(fields: [shopProductId], references: [id])

  @@map("loan_items")
}

model OnlineApplication {
  id                     String                 @id @default(uuid())
  source                 ApplicationSource
  applicationType        ApplicationType
  clientPhone            String
  clientName             String?
  idNumber               String?
  amount                 Decimal                @db.Decimal(15, 2)
  productId              String
  disbursementPreference DisbursementPreference
  bankAccount            String?
  mobileNumber           String?
  verificationCode       String?
  verificationExpiry     DateTime?
  status                 ApplicationStatus      @default(PENDING)
  notes                  String?
  createdAt              DateTime               @default(now())
  updatedAt              DateTime               @updatedAt
  loans                  Loan[]

  @@map("online_applications")
}

model SyncQueue {
  id             String     @id @default(uuid())
  organizationId String
  userId         String
  deviceId       String?
  entityType     String
  entityId       String
  action         SyncAction
  payload        Json
  version        Int        @default(1)
  status         SyncStatus @default(PENDING)
  error          String?
  retryCount     Int        @default(0)
  createdAt      DateTime   @default(now())
  syncedAt       DateTime?
  processedAt    DateTime?

  @@index([organizationId])
  @@index([userId])
  @@index([entityType, entityId])
  @@index([status])
  @@index([createdAt])
  @@map("sync_queue")
}

model SyncConflict {
  id             String    @id @default(uuid())
  organizationId String
  syncQueueId    String
  entityType     String
  entityId       String
  clientVersion  Int
  serverVersion  Int
  clientData     Json
  serverData     Json
  resolution     String?
  resolvedBy     String?
  resolvedAt     DateTime?
  createdAt      DateTime  @default(now())

  @@index([organizationId])
  @@index([entityType, entityId])
  @@index([resolution])
  @@map("sync_conflicts")
}

model EntityVersion {
  id             String   @id @default(uuid())
  organizationId String
  entityType     String
  entityId       String
  version        Int      @default(1)
  updatedAt      DateTime @default(now())
  updatedBy      String?

  @@unique([organizationId, entityType, entityId])
  @@index([organizationId, entityType])
  @@index([updatedAt])
  @@map("entity_versions")
}

model ClientDraft {
  id                     String    @id @default(uuid())
  organizationId         String
  userId                 String
  branchId               String?
  draftData              Json
  requiredFieldsComplete Boolean   @default(false)
  completionPercentage   Int       @default(0)
  lastFieldUpdated       String?
  version                Int       @default(1)
  expiresAt              DateTime?
  createdAt              DateTime  @default(now())
  updatedAt              DateTime  @updatedAt

  @@unique([organizationId, userId])
  @@index([organizationId])
  @@index([userId])
  @@index([updatedAt])
  @@map("client_drafts")
}

model Note {
  id             String           @id @default(uuid())
  organizationId String
  entityType     NoteEntityType
  entityId       String
  content        String
  priority       NotePriority     @default(NORMAL)
  isPinned       Boolean          @default(false)
  isPrivate      Boolean          @default(false)
  createdBy      String
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  attachments    NoteAttachment[]
  creator        User             @relation(fields: [createdBy], references: [id])

  @@index([organizationId])
  @@index([entityType, entityId])
  @@index([createdBy])
  @@index([createdAt])
  @@map("notes")
}

model NoteAttachment {
  id          String   @id @default(uuid())
  noteId      String
  fileName    String
  fileSize    Int
  mimeType    String
  storagePath String
  uploadedBy  String
  uploadedAt  DateTime @default(now())
  note        Note     @relation(fields: [noteId], references: [id], onDelete: Cascade)

  @@index([noteId])
  @@map("note_attachments")
}

enum OrganizationType {
  MICROFINANCE
  BANK
  CREDIT_UNION
  COOPERATIVE
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  MANAGER
  STAFF
  CLIENT
  ORG_ADMIN
  LOAN_OFFICER
  ACCOUNTANT
  TELLER
  API_CLIENT
}

enum ClientType {
  INDIVIDUAL
  GROUP
  BUSINESS
}

enum LoanClass {
  CONSUMER
  COMMERCIAL
}

enum LoanType {
  PERSONAL
  BUSINESS
  AGRICULTURAL
  EMERGENCY
  GROUP
}

enum LoanStatus {
  DRAFT
  PENDING
  PENDING_ASSESSMENT
  PENDING_VISIT
  PENDING_APPROVAL
  APPROVED
  PENDING_DISBURSEMENT
  ACTIVE
  OVERDUE
  COMPLETED
  CANCELLED
  DEFAULTED
  WRITTEN_OFF
  DEFAULT
}

enum LoanCalculationEngineType {
  SHORT_TERM
  LONG_TERM
  REDUCING_BALANCE
  FLAT_RATE
  CUSTOM
}

enum DurationUnit {
  DAYS
  WEEKS
  MONTHS
  YEARS
}

enum ChargeMode {
  MANUAL
  AUTO
}

enum ChargeApplication {
  PRINCIPAL
  BALANCE
  OTHER
}

enum VisitType {
  BUSINESS
  HOME
}

enum ApplicationSource {
  BRANCH
  WEB
  WHATSAPP
  FACEBOOK
}

enum ApplicationType {
  NEW
  EXISTING
}

enum DisbursementPreference {
  CASH
  TRANSFER
}

enum ApplicationStatus {
  PENDING
  VERIFIED
  PROCESSED
  EXPIRED
  REJECTED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
}

enum PaymentMethodType {
  CASH
  MOBILE_MONEY
  BANK_TRANSFER
  CHEQUE
  CARD
  DIGITAL_WALLET
  OTHER
}

enum FinancialTransactionType {
  INCOME
  EXPENSE
}

enum FinancialTransactionStatus {
  PENDING
  COMPLETED
  VOIDED
  CANCELLED
}

enum TransactionType {
  LOAN_DISBURSEMENT
  LOAN_REPAYMENT
  CHARGE
  PENALTY
  REFUND
}

enum ChargeCalculationType {
  PERCENTAGE
  FIXED
  PERCENTAGE_BALANCE
}

enum ChargeAppliesAt {
  DISBURSEMENT
  APPROVAL
  SETTLEMENT
  LATE_PAYMENT
  MONTHLY
  MANUAL
  REPAYMENT
  OVERDUE
  CLOSURE
}

enum RepaymentFrequency {
  DAILY
  WEEKLY
  BIWEEKLY
  MONTHLY
  QUARTERLY
  SEMI_ANNUAL
  ANNUAL
}

enum LoanCalculationMethod {
  FLAT_RATE
  REDUCING_BALANCE
  SIMPLE_INTEREST
  COMPOUND_INTEREST
  ANNUITY
  BALLOON_PAYMENT
  CUSTOM_FORMULA
}

enum ChargeType {
  ADMIN_FEE
  APPLICATION_FEE
  PROCESSING_FEE
  SERVICE_FEE
  LEGAL_FEE
  DOCUMENTATION_FEE
  INSURANCE_FEE
  STAMP_DUTY
  LATE_FEE
  PENALTY
  EARLY_SETTLEMENT_FEE
  COLLECTION_FEE
  RESTRUCTURE_FEE
  OTHER
  INSURANCE
  DISBURSEMENT_FEE
  EARLY_REPAYMENT_FEE
  LATE_PAYMENT_FEE
  PENALTY_FEE
  VALUATION_FEE
}

enum ApiTier {
  BASIC
  PROFESSIONAL
  ENTERPRISE
  CUSTOM
}

enum Currency {
  ZWG
  USD
  ZAR
  BWP
}

enum AddressType {
  RESIDENTIAL
  BUSINESS
  POSTAL
  PREVIOUS
}

enum ContactType {
  MOBILE
  LANDLINE
  EMAIL
  FAX
}

enum DocumentStatus {
  PENDING
  UPLOADED
  VERIFIED
  REJECTED
  EXPIRED
}

enum BusinessType {
  SOLE_PROPRIETOR
  PARTNERSHIP
  PRIVATE_LIMITED
  PUBLIC_LIMITED
  COOPERATIVE
  TRUST
  NGO
  OTHER
}

enum OwnershipStatus {
  FULLY_OWNED
  FINANCED
  LEASED
  JOINT_OWNERSHIP
}

enum CollateralStatus {
  AVAILABLE
  PLEDGED
  RELEASED
  REPOSSESSED
  SOLD
}

enum ImportType {
  CLIENTS
  LOANS
  PAYMENTS
  GROUPS
  EMPLOYERS
}

enum ImportStatus {
  PENDING
  VALIDATING
  PROCESSING
  COMPLETED
  FAILED
  PARTIALLY_COMPLETED
}

enum AuditStatus {
  SUCCESS
  FAILURE
  PARTIAL
}

enum SyncStatus {
  SYNCED
  PENDING
  CONFLICT
}

enum SyncAction {
  CREATE
  UPDATE
  DELETE
}

enum NoteEntityType {
  CLIENT
  LOAN
  PAYMENT
  DISBURSEMENT
  LOAN_APPLICATION
  COLLATERAL
  GROUP
}

enum NotePriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum TargetType {
  DISBURSEMENT
  REPAYMENT
}

model MonthlyTarget {
  id             String       @id @default(uuid())
  organizationId String
  branchId       String
  currency       Currency
  targetType     TargetType
  targetAmount   Decimal      @db.Decimal(15, 2)
  year           Int
  month          Int          // 1-12
  notes          String?
  isActive       Boolean      @default(true)
  createdBy      String?
  updatedBy      String?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  branch         Branch       @relation(fields: [branchId], references: [id], onDelete: Cascade)

  @@unique([organizationId, branchId, currency, targetType, year, month])
  @@index([organizationId])
  @@index([branchId])
  @@index([year, month])
  @@map("monthly_targets")
}
